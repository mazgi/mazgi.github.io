<!DOCTYPE html>
<html lang="en">
  <head>
	<meta name="generator" content="Hugo 0.37.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    
    
    <title>mazgi.log</title>
    <meta property="og:title"       content="mazgi.log" />
    <meta property="og:type"        content="website" />
    
    <meta property="og:url"         content="https://mazgi.github.io/" />
    <meta property="og:description" content="" />
    
    
    
    
    
    
    
    
    
    
    <meta name="twitter:card"       content="summary" />
    
    <meta name="twitter:site"       content="@mazgi" />
    
    
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      <ul class="navbar-nav">
        
      </ul>
    </header>
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://mazgi.github.io/">mazgi.log</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_nav" aria-controls="navbar_nav" aria-expand="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_nav">
        
        <ul class="navbar-nav mr-auto">
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbar_dropdown_lang" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              ç¿»è¨³ã‚’è¡¨ç¤º
            </a>
            <div class="dropdown-menu" aria-labelledby="navbar_dropdown_lang">
              
              <a class="dropdown-item" href="https://mazgi.github.io/en/">
                <span class="badge badge-light">English</span>
                mazgi.log
              </a>
              
            </div>
          </li>
          
          
        </ul>
        
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/share?url=https%3a%2f%2fmazgi.github.io%2f&text=mazgi.log" target="_blank">tw</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmazgi.github.io%2f" target="_blank">fb</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fmazgi.github.io%2f&title=mazgi.log" target="_blank">in</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://plusone.google.com/_/+1/confirm?url=https%3a%2f%2fmazgi.github.io%2f" target="_blank">g+</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://b.hatena.ne.jp/entry/https://mazgi.github.io/" target="_blank">b!</a>
          </li>
        </ul>
        
      </div>
    </nav>
    <main role="main" class="container-fluid col-lg-10 offset-lg-1">

<div class="row">
  <div class="col-lg-9">
    
    
    <article>
      <div class="row">
        <h1><a href="/posts/2018.03/setup-amazon-sagemaker/">Amazon SageMakerã‚’ãã‚Œãªã‚Šã®äººæ•°ã§ä½¿ã†ã¨ãã®è¨­å®š</a></h1>
      </div>
      

<p>AWSã®ãƒãƒãƒ¼ã‚¸ãƒ‰Jupyterã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹ã€ŒAmazon SageMakerã€ã‚’æ•°ååè¦æ¨¡ã§ä½¿ã†æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã‚¤ãƒ³ãƒ•ãƒ©çš„ã«è¨­å®šã—ãŸå†…å®¹ãªã©ã‚’æ›¸ã„ã¦ãŠãã€‚<br />
<del>SageMakerã§ä½•ã‚’ã—ãŸã‹ãªã©ã¯ã„ãšã‚Œã¡ã‚ƒã‚“ã¨ã—ãŸæƒ…å ±ãŒå‡ºã‚‹ã¨æ€ã†ã€‚</del> å‡ºã¾ã—ãŸï¼<br />
=&gt; <a href="https://engineer.dena.jp/2018/03/amazon-sagemaker.html">Amazon SageMaker ãƒãƒ³ã‚ºã‚ªãƒ³ãƒ¬ãƒãƒ¼ãƒˆ</a></p>

<h1 id="amazon-sagemakerã¨ã¯">Amazon SageMakerã¨ã¯?</h1>

<p>AWSã®WebUIã§ã½ã¡ã½ã¡ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã„ãã¨JupyterãŒèµ·å‹•ã™ã‚‹ã€ãã†ã„ã†ã‚„ã¤ã§ã™ã€‚<br />
SageMakerã®ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚µã‚¤ãƒˆã¯ã“ã¡ã‚‰ã€‚<br />
<a href="https://aws.amazon.com/jp/sagemaker/">æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | AWS ã§ã® Amazon SageMaker</a></p>

<h1 id="amazon-sagemakerã®èµ·å‹•æ–¹æ³•">Amazon SageMakerã®èµ·å‹•æ–¹æ³•</h1>

<p>ã¾ãšã‚¢ã‚¯ã‚»ã‚¹ã™ã¹ãã¯ã“ã¡ã‚‰ã€‚<br />
<a href="https://console.aws.amazon.com/sagemaker/home#/notebook-instances">https://console.aws.amazon.com/sagemaker/home#/notebook-instances</a></p>

<p>ã€ŒCreate notebook instanceã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã“ã®ã‚ˆã†ãªç”»é¢ã«ãªã‚‹ã®ã§é …ç›®ã‚’åŸ‹ã‚ã¦ã„ãã€‚<br />

<figure>
    
        <img src="/posts/2018.03/setup-amazon-sagemaker/0001.png" />
    
    
</figure>
</p>

<p>ã‚ã‚‹ç¨‹åº¦ã®äººæ•°ã§ä½¿ã†å ´åˆã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªé …ç›®ã‚’å–ã‚Šæ±ºã‚ã¦ãŠãã¨è‰¯ã•ãã†ã€‚</p>

<ul>
<li>Notebook instance name

<ul>
<li>æ–‡å­—é€šã‚ŠNotebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åå‰ã«ãªã‚‹ã»ã‹ã€Jupyter Notebookã®URLã®ä¸€éƒ¨ã¨ã—ã¦ã‚‚ä½¿ã‚ã‚Œã‚‹</li>
<li>èª°ãŒä½œã£ãŸã‹ã¨ã‹ä½•ã®ç›®çš„ãªã®ã‹ã¨ã‹å‘½åãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã¦ãŠãã¨è‰¯ã•ãã†</li>
</ul></li>
<li>Notebook instance type

<ul>
<li>ã„ãã¤ã‹é¸ã¹ã‚‹</li>
<li>Notebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç´”ç²‹ã«Notebookã§ã‚ã£ã¦ã€ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§jobãŒå‹•ãã‚ã‘ã§ã¯ãªã„ã®ã§ãã‚“ãªã«å¼·åŠ›ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ãªãã¦ã‚‚ã‚ˆã„</li>
<li>ãªãŠå®Ÿéš›ã«jobã‚’å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã¯ p2/p3 ãªã©ã®GPUã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚‚é¸ã¹ã‚‹</li>
</ul></li>
<li>IAM role(å¾Œè¿°)

<ul>
<li>Notebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ä¸ãˆã‚‹Roleã€ã“ã®æ¨©é™ã§jobãªã©ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚ã†ã¨ã™ã‚‹</li>
<li>Roleã‚’ä½œæˆã™ã‚‹ã‹æ—¢å­˜ã®Roleã‹ã‚‰é¸æŠã™ã‚‹ã‹ãªã©ãŒé¸ã¹ã‚‹</li>
<li>ãƒãƒ¼ãƒ ã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã§ä½¿ã†ã®ã§ã‚ã‚Œã°ã‚ã‚‰ã‹ã˜ã‚Roleã‚’ä½œã£ã¦ãŠã„ã¦ARNã‚’å…¥åŠ›ã—ã¦ã‚‚ã‚‰ã†æ–¹ãŒç®¡ç†ä¸Šã‚ˆã„ã¨æ€ã†</li>
</ul></li>
<li>Custom IAM role ARN

<ul>
<li>å‰è¿°ã®ã€ŒIAM roleã€ã§æ—¢å­˜ã®Roleã‚’é¸ã¶ã“ã¨ã«ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹</li>
<li>ç§ã¯ã‚ã‚‰ã‹ã˜ã‚ä½œã£ã¦ãŠã„ãŸRoleã‚’å…¥åŠ›ã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã«ã—ãŸ</li>
</ul></li>
<li>VPC

<ul>
<li>ã¨ã‚Šã‚ãˆãšä½¿ã†ã ã‘ãªã‚‰ <code>No VPC</code> ã§ã‚ˆã„</li>
<li>ã“ã“ã§æŒ‡å®šã—ãŸVPCã«SageMakerãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„(æœªæ¤œè¨¼)</li>
<li>&ldquo;Notebook instances will have internet access independent of your VPC setting.&ldquo;ã¨ã‚ã‚‹é€šã‚Šã€ã“ã“ã§VPCã‚’æŒ‡å®šã—ãŸã‹ã‚‰ã¨ã„ã£ã¦SageMakerã‚„Notebookã‚’ç‰¹å®šã®VPCã«é–‰ã˜è¾¼ã‚ã‚‹ã“ã¨ã¯ã§ããªã„ã®ã§æ³¨æ„</li>
</ul></li>
</ul>

<p>ä»¥ä¸Šã®ã‚ˆã†ãªé …ç›®ã‚’åŸ‹ã‚ã¦ã€ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã®ã€ŒCreate notebook instanceã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨Notebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæº–å‚™ã•ã‚Œã‚‹ã®ã§ã€ŒInServiceã€ã«ãªã‚‹ã¾ã§æ•°åˆ†ã€œ10æ•°åˆ†ç¨‹åº¦å¾…ã¤ã€‚<br />
æ¡ˆå¤–æ™‚é–“ãŒã‹ã‹ã‚‹ãŒè£å´ã§ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãªã©ã‚’è¡Œãªã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã€‚</p>

<p>ã€ŒInServiceã€ã«ãªã£ãŸNotebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ã‚’ã¿ã‚‹ã¨å³ä¸Šã«ã€ŒOpenã€ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ã®ã§ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚<br />

<figure>
    
        <img src="/posts/2018.03/setup-amazon-sagemaker/0002.png" />
    
    
</figure>
</p>

<p>ãã†ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§è¦‹æ…£ã‚ŒãŸJupyter Notebookã®ç”»é¢ãŒé–‹ãã®ã§å¥½ããªã‚ˆã†ã«ä½¿ã†ã€‚<br />

<figure>
    
        <img src="/posts/2018.03/setup-amazon-sagemaker/0003.png" />
    
    
</figure>
</p>

<p>ã“ã‚“ãªã«æ¥½ã ã¨è‡ªåˆ†ã§Jupyter Notebookç«‹ã¦ã‚‹ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªããªã£ã¦è‰¯ã„ã§ã™ã­ã€‚</p>

<h1 id="iam-role-groupä½œæˆ">IAM Role/Groupä½œæˆ</h1>

<p>ä»¥ä¸‹ã‚’ç”¨æ„ã—ãŸ</p>

<ul>
<li>IAM Role

<ul>
<li>å‰è¿°ã®ã€Notebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ä¸ãˆã‚‹Role</li>
<li>æœ€å°é™ <code>AmazonSageMakerFullAccess</code> ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¦ãŠã‘ã°è‰¯ã„</li>
</ul></li>
<li>IAM Group

<ul>
<li>ä»Šå›ã¯1ã¤ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§æ•°ååãŒåŒæ™‚ã«SageMakerã‚’ä½¿ã†ãŸã‚ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç´ã¥ã‘ã‚‹ã“ã¨ã«ã—ãŸ</li>
<li>ä»¥ä¸‹ã‚’ã‚¢ã‚¿ãƒƒãƒã—ãŸ(ã‚‚ã†å°‘ã—çµã‚Šè¾¼ã‚ãã†ã§ã¯ã‚ã‚‹)</li>
<li><code>AmazonSageMakerFullAccess</code></li>
<li><code>AmazonEC2FullAccess</code></li>
<li><code>IAMReadOnlyAccess</code></li>
<li><code>IAMUserChangePassword</code> (ã“ã‚Œã¯é‹ç”¨ä¸Šå¿…è¦ã ã£ãŸã ã‘)</li>
</ul></li>
<li>IAM User(s)

<ul>
<li>SageMakerã‚’ä½¿ã†äººå…¨å“¡åˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‰•ã„å‡ºã—ã€å‰è¿°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ç´ä»˜ã‘ãŸ</li>
<li>ä»Šå›ã¯åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç§ã®æ‰‹å…ƒã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã—ã€å„è‡ªåˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å¤‰æ›´ã—ã¦ã‚‚ã‚‰ã£ãŸ</li>
</ul></li>
</ul>

<p>ä»¥ä¸Šã®è¨­å®šã‚’Terraformã§è¡Œã† <code>.tf</code> ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ã¯æ¬¡ã®é€šã‚Šã€‚<br />
å†…å®¹ã¯ã»ã¼ãã®ã¾ã¾ã€å€‹ã€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯åˆ¥é€”å¤‰æ•°ã‹ã‚‰èª­ã‚“ã§ã„ã‚‹ã€‚</p>

<script src="//gist.github.com/mazgi/aebcf7cac9ed5ca5f3f1d0f69557a820.js"></script>

<h1 id="awsãƒªã‚½ãƒ¼ã‚¹ä¸Šé™ç·©å’Œç”³è«‹">AWSãƒªã‚½ãƒ¼ã‚¹ä¸Šé™ç·©å’Œç”³è«‹</h1>

<p>AWS SAã®æ–¹ã«ã”ç›¸è«‡ã®ä¸Šã€SageMakerã‚’åˆ©ç”¨ã™ã‚‹ <code>IAM Useræ•° * n</code> ã§äº‹å‰ã«ãƒªã‚½ãƒ¼ã‚¹ä¸Šé™ã®ç·©å’Œç”³è«‹ã‚’è¡Œãªã£ãŸã€‚<br />
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã“ã¡ã‚‰ã€‚<br />
<a href="https://docs.aws.amazon.com/ja_jp/general/latest/gr/aws_service_limits.html#limits_sagemaker">AWS ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ - ã‚¢ãƒã‚¾ãƒ³ ã‚¦ã‚§ãƒ– ã‚µãƒ¼ãƒ“ã‚¹#Amazon SageMaker ã®åˆ¶é™</a></p>

<p>å†…å®¹ã¯ã–ã£ã¨æ¬¡ã®é€šã‚Šã€‚<br />
å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒNotebookã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’1ã¤ã€å­¦ç¿’ã¨æ¨è«–ã®jobã‚’2ã¤ãšã¤å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ãŸã€‚</p>

<ul>
<li>SageMaker ã®ãƒ›ã‚¹ãƒˆ

<ul>
<li>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: <code>IAM Useræ•° * 3</code></li>
<li>(ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—): <code>IAM Useræ•° * 3</code></li>
<li>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: <code>IAM Useræ•° * 3</code></li>
<li><em>ã“ã‚Œã¯ä¸è¦ã ã£ãŸã‚ˆã†ã </em></li>
</ul></li>
<li>SageMaker ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

<ul>
<li>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: <code>IAM Useræ•° * 3</code></li>
<li>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¸ãƒ§ãƒ–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°: <code>IAM Useræ•° * 3</code></li>
<li>(ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—): <code>IAM Useræ•° * 3</code></li>
</ul></li>
<li>SageMaker ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯

<ul>
<li>(ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—): <code>IAM Useræ•° * 1.5</code></li>
<li>å®Ÿè¡Œä¸­ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ•°: <code>IAM Useræ•° * 1.5</code></li>
</ul></li>
</ul>

<p>ä¸€éƒ¨CloudTrailã®ä¸Šé™ã«å¼•ã£ã‹ã‹ã‚ŠåŒæ™‚å®Ÿè¡Œã§ããªã‹ã£ãŸã‚Šã‚‚ã—ãŸãŒã€æ¦‚ã­ã“ã‚Œã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡ãŒç›®çš„ã®æ“ä½œã‚’è¡ŒãˆãŸã€‚<br />
AWSã®ãƒªã‚½ãƒ¼ã‚¹ä¸Šé™ã¯ãªã‹ãªã‹é›£ã—ã„ã®ã§AWS SAã®æ–¹ã«ç›¸è«‡ã™ã‚‹ã«é™ã‚‹ğŸ™</p>

<h1 id="æ„Ÿæƒ³">æ„Ÿæƒ³</h1>

<p>ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã¦ãŠã‘ã°ä½¿ã„ãŸã„äººã«ã‚µã‚¯ãƒƒã¨ä½¿ã£ã¦ã‚‚ã‚‰ãˆã¦å¤§å¤‰ä¾¿åˆ©ã€‚<br />
å„ç¨®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ‹…ä¿ã®æ–¹æ³•ã‚„è¾¼ã¿å…¥ã£ãŸä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ä»Šå¾Œä½¿ã£ã¦ã‚‚ã‚‰ã„ãªãŒã‚‰å·¥å¤«ã—ã¦ã„ããŸã„ã€‚</p>

    </article>
    
    <hr/>
    
    
    <article>
      <div class="row">
        <h1><a href="/posts/2018.03/s3fs-for-s3-with-sse-kms/">SSE-KMSã§æš—å·åŒ–ã—ãŸS3ãƒã‚±ãƒƒãƒˆã‚’s3fsã§mountã™ã‚‹</a></h1>
      </div>
      

<p>ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€ŒAWS Key Management Service (AWS KMS) ã€ã‚’ä½¿ã£ã¦æš—å·åŒ–ã—ãŸAmazon S3ãƒã‚±ãƒƒãƒˆã‚’s3fsã§Ubuntu 16ä¸Šã§mountã—ãŸã€‚<br />
KMSã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè©³ã—ã„ãŒè¦ã¯æš—å·åŒ–ã®éš›ã«ç…©é›‘ãªéµã®ç®¡ç†ã‚’AWSã«ãŠé¡˜ã„ã§ãã‚‹ä»•çµ„ã¿ã€‚</p>

<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/UsingKMSEncryption.html">AWS KMS ã§ç®¡ç†ã•ã‚ŒãŸã‚­ãƒ¼ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼å´ã®æš—å·åŒ– (SSE-KMS) ã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¿è­· - Amazon Simple Storage Service</a></p>

<h1 id="s3ãƒã‚±ãƒƒãƒˆã®æº–å‚™">S3ãƒã‚±ãƒƒãƒˆã®æº–å‚™</h1>

<p>S3ãƒã‚±ãƒƒãƒˆã‚’ä½œã‚Šã€ç”»åƒã®ã‚ˆã†ã« <code>Default encryption</code> ã‚’ <code>AWS-KMS</code> ã«è¨­å®šã™ã‚‹ã€‚<br />
ãªãŠã“ã®S3ãƒã‚±ãƒƒãƒˆã¯è¨˜äº‹å…¬é–‹æ™‚ç‚¹ã§å‰Šé™¤æ¸ˆã¿ã€‚</p>


<figure>
    
        <img src="/posts/2018.03/s3fs-for-s3-with-sse-kms/0001.png" />
    
    
</figure>


<h1 id="s3fsã®è¨­å®š">s3fsã®è¨­å®š</h1>

<h2 id="install">Install</h2>

<p>GitHubã‹ã‚‰ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ./autogen.sh
$ ./configure
$ make
$ sudo make install</code></pre></div>

<p>ã™ã‚‹ã€‚</p>

<p><a href="https://github.com/s3fs-fuse/s3fs-fuse/releases/tag/v1.83">Release Release verson 1.83 Â· s3fs-fuse/s3fs-fuse</a></p>

<h2 id="mount">mount</h2>

<p>ä»¥ä¸‹ã®ã‚ˆã†ã«AWSã®credentialã‚’ <code>.secret</code> ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã« <code>ACCESS_KEY:SECRET_KEY</code> ã¨ã„ã†ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§æ›¸ãã€‚<br />
ã¾ãŸKMSã®éµIDã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã—ãŸã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat .secret
****ACCESS_KEY****:****SECRET_KEY****
$ export AWSSSEKMSID<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;********&#39;</span></code></pre></div>

<p>ãã—ã¦mountã™ã‚‹ã€‚<br />
<code>endpoint</code>, <code>uid</code>, <code>gid</code> , <code>umask</code> ã‚ãŸã‚Šã‚’ãã¡ã‚“ã¨è¨­å®šã—ãªã„ã¨èª­ã¿æ›¸ãã§ããªã„ã€ãƒãƒã£ãŸã€‚<br />
ãªãŠéµIDã¯ç’°å¢ƒå¤‰æ•°ä½¿ã‚ãªãã¦ã‚‚ <code>use_sse=kmsid:&quot;${AWSSSEKMSID}&quot;</code> ã§ã„ã‘ã‚‹æ¨¡æ§˜ã€‚</p>

<p>ã¾ãŸ <code>-d</code> ã¯debugã€ <code>-f</code> ã¯ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ s3fs mazgi-s3-sse-kms-test-01-bucket-01 bucket -o passwd_file<span style="color:#f92672">=</span>.secret,use_sse<span style="color:#f92672">=</span>kmsid,endpoint<span style="color:#f92672">=</span>ap-northeast-1,allow_other,uid<span style="color:#f92672">=</span><span style="color:#ae81ff">1234</span>,gid<span style="color:#f92672">=</span><span style="color:#ae81ff">1234</span>,umask<span style="color:#f92672">=</span><span style="color:#ae81ff">227</span> -d -f
<span style="color:#f92672">[</span>CRT<span style="color:#f92672">]</span> s3fs.cpp:set_s3fs_log_level<span style="color:#f92672">(</span><span style="color:#ae81ff">271</span><span style="color:#f92672">)</span>: change debug level from <span style="color:#f92672">[</span>CRT<span style="color:#f92672">]</span> to <span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> 
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>     s3fs.cpp:set_mountpoint_attribute<span style="color:#f92672">(</span><span style="color:#ae81ff">4206</span><span style="color:#f92672">)</span>: PROC<span style="color:#f92672">(</span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">4600</span>, gid<span style="color:#f92672">=</span><span style="color:#ae81ff">4600</span><span style="color:#f92672">)</span> - MountPoint<span style="color:#f92672">(</span>uid<span style="color:#f92672">=</span><span style="color:#ae81ff">4600</span>, gid<span style="color:#f92672">=</span><span style="color:#ae81ff">4600</span>, mode<span style="color:#f92672">=</span><span style="color:#ae81ff">40775</span><span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_init<span style="color:#f92672">(</span><span style="color:#ae81ff">3371</span><span style="color:#f92672">)</span>: init v1.83<span style="color:#f92672">(</span>commit:unknown<span style="color:#f92672">)</span> with OpenSSL
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_check_service<span style="color:#f92672">(</span><span style="color:#ae81ff">3747</span><span style="color:#f92672">)</span>: check services.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:CheckBucket<span style="color:#f92672">(</span><span style="color:#ae81ff">3068</span><span style="color:#f92672">)</span>: check a bucket.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span></code></pre></div>

<h2 id="ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ">ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ</h2>

<p><code>ls</code> ã—ã¦ã¿ã‚‹ã€‚</p>

<p>ãªãŠS3ãƒã‚±ãƒƒãƒˆã«å…¥ã£ã¦ã„ã‚‹JPEGç”»åƒã¯ã“ã‚Œã€‚ã‹ã‚ã„ã„ã€‚<br />
ã€Œ<a href="https://www.pakutaso.com/">ã±ããŸã</a>ã€ã‹ã‚‰ãŠå€Ÿã‚Šã—ãŸã€‚</p>

<p>
<figure>
    
        <img src="/posts/2018.03/s3fs-for-s3-with-sse-kms/0002.jpeg" />
    
    
</figure>
</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l bucket
total <span style="color:#ae81ff">179</span>
-r-xr-x--- <span style="color:#ae81ff">1</span> user group <span style="color:#ae81ff">96870</span> Feb  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">07</span>:10 cat.jpg*
-r-xr-x--- <span style="color:#ae81ff">1</span> user group <span style="color:#ae81ff">84999</span> Feb  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">07</span>:13 cat_plain.jpg*</code></pre></div>

<p>ãã®æ™‚ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_opendir<span style="color:#f92672">(</span><span style="color:#ae81ff">2281</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">][</span>flags<span style="color:#f92672">=</span><span style="color:#ae81ff">100352</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_readdir<span style="color:#f92672">(</span><span style="color:#ae81ff">2432</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>   s3fs.cpp:list_bucket<span style="color:#f92672">(</span><span style="color:#ae81ff">2477</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:ListBucketRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3103</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>&amp;prefix<span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>&amp;prefix<span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>&amp;prefix<span style="color:#f92672">=]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>   s3fs.cpp:readdir_multi_head<span style="color:#f92672">(</span><span style="color:#ae81ff">2346</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">][</span>list<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=</span>cat.jpg<span style="color:#f92672">][</span>save<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/cat.jpg<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat_plain.jpg<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=</span>cat_plain.jpg<span style="color:#f92672">][</span>save<span style="color:#f92672">=</span>/cat_plain.jpg<span style="color:#f92672">][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat_plain.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat_plain.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/cat_plain.jpg<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:Request<span style="color:#f92672">(</span><span style="color:#ae81ff">3999</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>count<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat_plain.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat_plain.jpg<span style="color:#f92672">]</span></code></pre></div>

<p>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‰ã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ ãŒã“ã‚Œã€‚</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ shasum -a <span style="color:#ae81ff">1</span> cat.jpg
fb9f3c47ad3d91ced2e62c82f0ae753330351b32  cat.jpg</code></pre></div></p>

<p>mountã—ãŸS3ãƒã‚±ãƒƒãƒˆã‹ã‚‰èª­ã¿å–ã‚Šãƒ†ã‚¹ãƒˆå…¼ã­ã¦ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’å–å¾—ã—ã¦ã¿ã‚‹ã€‚<br />
ä¸€è‡´ã—ã¦ã„ã‚‹ã®ã§æ­£ã—ãèª­ã¿å–ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sha1sum bucket/cat.jpg
fb9f3c47ad3d91ced2e62c82f0ae753330351b32  bucket/cat.jpg</code></pre></div>

<p>ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šæ™‚ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_open<span style="color:#f92672">(</span><span style="color:#ae81ff">2063</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>flags<span style="color:#f92672">=</span><span style="color:#ae81ff">32768</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:DelStat<span style="color:#f92672">(</span><span style="color:#ae81ff">565</span><span style="color:#f92672">)</span>: delete stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/cat.jpg<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:SetMtime<span style="color:#f92672">(</span><span style="color:#ae81ff">1019</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">][</span>time<span style="color:#f92672">=</span><span style="color:#ae81ff">1517436613</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:GetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3043</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>start<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">96870</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreGetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2983</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>start<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">96870</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/cat.jpg<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:GetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3058</span><span style="color:#f92672">)</span>: downloading... <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">206</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_flush<span style="color:#f92672">(</span><span style="color:#ae81ff">2185</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:RowFlush<span style="color:#f92672">(</span><span style="color:#ae81ff">1434</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=][</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_release<span style="color:#f92672">(</span><span style="color:#ae81ff">2238</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:GetFdEntity<span style="color:#f92672">(</span><span style="color:#ae81ff">1995</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/cat.jpg<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span></code></pre></div>

<p>ä»Šåº¦ã¯S3ãƒã‚±ãƒƒãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚“ã§ã¿ã‚‹ã€‚<br />
é©å½“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’å–å¾—ã€‚</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ head -1 /dev/urandom|od -x &gt; rand.txt
$ sha1sum rand.txt
bb02ee0d5fc5b459ca1978fcc0e53649d144554c  rand.txt</code></pre></div></p>

<p>ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚<br />
ã‚³ãƒ”ãƒ¼å¾Œã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã®ã§æ­£ã—ãã‚³ãƒ”ãƒ¼ã§ããŸã“ã¨ãŒã‚ã‹ã‚‹ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cp rand.txt bucket/
$ sha1sum bucket/rand.txt
bb02ee0d5fc5b459ca1978fcc0e53649d144554c  bucket/rand.txt</code></pre></div>

<p>æ›¸ãè¾¼ã¿æ™‚ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt_$folder$<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>   s3fs.cpp:list_bucket<span style="color:#f92672">(</span><span style="color:#ae81ff">2477</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:ListBucketRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3103</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt_$folder$<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>   s3fs.cpp:list_bucket<span style="color:#f92672">(</span><span style="color:#ae81ff">2477</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:ListBucketRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3103</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_create<span style="color:#f92672">(</span><span style="color:#ae81ff">999</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>mode<span style="color:#f92672">=</span><span style="color:#ae81ff">100664</span><span style="color:#f92672">][</span>flags<span style="color:#f92672">=</span><span style="color:#ae81ff">32961</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt/<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt_$folder$<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt_$folder$<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2073</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">404</span> was returned, returning ENOENT
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>   s3fs.cpp:list_bucket<span style="color:#f92672">(</span><span style="color:#ae81ff">2477</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:ListBucketRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3103</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>delimiter<span style="color:#f92672">=</span>/&amp;max-keys<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>&amp;prefix<span style="color:#f92672">=</span>rand.txt/<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>WAN<span style="color:#f92672">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#f92672">(</span><span style="color:#ae81ff">2575</span><span style="color:#f92672">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>     s3fs.cpp:create_file_object<span style="color:#f92672">(</span><span style="color:#ae81ff">960</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>mode<span style="color:#f92672">=</span><span style="color:#ae81ff">100664</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PutRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2872</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PutRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2889</span><span style="color:#f92672">)</span>: create zero byte file object.
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>PUT<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PutRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2969</span><span style="color:#f92672">)</span>: uploading... <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span>-1<span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:DelStat<span style="color:#f92672">(</span><span style="color:#ae81ff">565</span><span style="color:#f92672">)</span>: delete stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_flush<span style="color:#f92672">(</span><span style="color:#ae81ff">2185</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:RowFlush<span style="color:#f92672">(</span><span style="color:#ae81ff">1434</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=][</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PutRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2872</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>PUT<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[</span>2a5b392dff6867a115948ff04fbec762a6f007cffebf40544c62308ec9eab099<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PutRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2969</span><span style="color:#f92672">)</span>: uploading... <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">996</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_release<span style="color:#f92672">(</span><span style="color:#ae81ff">2238</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:DelStat<span style="color:#f92672">(</span><span style="color:#ae81ff">565</span><span style="color:#f92672">)</span>: delete stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:GetFdEntity<span style="color:#f92672">(</span><span style="color:#ae81ff">1995</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span></code></pre></div>

<p>ã“ã¡ã‚‰ã¯ãƒã‚§ãƒƒã‚¯ã‚µãƒ å–å¾—æ™‚ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã€‚</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_open<span style="color:#f92672">(</span><span style="color:#ae81ff">2063</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>flags<span style="color:#f92672">=</span><span style="color:#ae81ff">32768</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:DelStat<span style="color:#f92672">(</span><span style="color:#ae81ff">565</span><span style="color:#f92672">)</span>: delete stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:HeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2708</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreHeadRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2657</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>bpath<span style="color:#f92672">=][</span>save<span style="color:#f92672">=][</span>sseckeypos<span style="color:#f92672">=</span>-1<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>HEAD<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">200</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       cache.cpp:AddStat<span style="color:#f92672">(</span><span style="color:#ae81ff">356</span><span style="color:#f92672">)</span>: add stat cache entry<span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:SetMtime<span style="color:#f92672">(</span><span style="color:#ae81ff">1019</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">][</span>time<span style="color:#f92672">=</span><span style="color:#ae81ff">1517862525</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:GetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3043</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>start<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">996</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:PreGetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">2983</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>start<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span>size<span style="color:#f92672">=</span><span style="color:#ae81ff">996</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4253</span><span style="color:#f92672">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:prepare_url<span style="color:#f92672">(</span><span style="color:#ae81ff">4285</span><span style="color:#f92672">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:insertV4Headers<span style="color:#f92672">(</span><span style="color:#ae81ff">2400</span><span style="color:#f92672">)</span>: computing signature <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>/rand.txt<span style="color:#f92672">]</span> <span style="color:#f92672">[]</span> <span style="color:#f92672">[]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:url_to_host<span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)</span>: url is https://s3.amazonaws.com
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:GetObjectRequest<span style="color:#f92672">(</span><span style="color:#ae81ff">3058</span><span style="color:#f92672">)</span>: downloading... <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       curl.cpp:RequestPerform<span style="color:#f92672">(</span><span style="color:#ae81ff">2051</span><span style="color:#f92672">)</span>: HTTP response code <span style="color:#ae81ff">206</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_getattr<span style="color:#f92672">(</span><span style="color:#ae81ff">841</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_flush<span style="color:#f92672">(</span><span style="color:#ae81ff">2185</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:RowFlush<span style="color:#f92672">(</span><span style="color:#ae81ff">1434</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>tpath<span style="color:#f92672">=][</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span> s3fs.cpp:s3fs_release<span style="color:#f92672">(</span><span style="color:#ae81ff">2238</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>INF<span style="color:#f92672">]</span>       fdcache.cpp:GetFdEntity<span style="color:#f92672">(</span><span style="color:#ae81ff">1995</span><span style="color:#f92672">)</span>: <span style="color:#f92672">[</span>path<span style="color:#f92672">=</span>/rand.txt<span style="color:#f92672">][</span>fd<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span><span style="color:#f92672">]</span></code></pre></div></p>

<p>ä»¥ä¸Šã€ã¡ã‚‡ã£ã¨ãƒãƒã£ãŸãŒã§ãã¦ã¿ã‚‹ã¨ã‚ã£ã•ã‚Šæš—å·åŒ–ã—ãŸS3ãƒã‚±ãƒƒãƒˆãŒæ‰±ãˆãŸã€‚</p>

<p>ã§ã€ã€Œã“ã‚Œã‚’provisioningã™ã‚‹ã®æ™‚é–“ãŒãªã„ãªãƒ¼ã€ã¨ã‹æ€ã£ã¦ãŸã‚‰æ–œã‚å¾Œã‚ã®ãƒ™ãƒ†ãƒ©ãƒ³ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã‚µã‚¯ãƒƒã¨itamaeã®recipeã«ã—ã¦ãã‚ŒãŸã€‚æ„Ÿè¬ã€‚</p>

    </article>
    
    <hr/>
    
    
    <article>
      <div class="row">
        <h1><a href="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/">S3&#43;CloudFrontã‚’Terraformã§è¨­å®šã—ã¦CircleCIã§æ›´æ–°ã™ã‚‹</a></h1>
      </div>
      

<p>ã€ŒTerraformã§S3+CloudFront+SSL/TLSè¨¼æ˜æ›¸ w/ ACMã‚’è¨­å®šã—ã¦Hugoã§ä½œã£ãŸstaticãªWebã‚µã‚¤ãƒˆã‚’CircleCIã§è‡ªå‹•deployã™ã‚‹ã€ã‚„ã¤ãŒã§ããŸã€‚</p>

<h1 id="ã§ããŸã‚‚ã®">ã§ããŸã‚‚ã®</h1>

<p>æ™®é€šã®ã„ã‹ã«ã‚‚<a href="https://gohugo.io/">Hugo</a>ã§ä½œã£ãŸWebã‚µã‚¤ãƒˆãŒã§ããŸã€‚<br />
ã‚‚ã†2018å¹´ãªã®ã§æ‰‹ã‚ªãƒšãªã©ã›ãšInfrastructure as Codeã§æ§‹ç¯‰ã‹ã¤CIã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„deployã§ã™ã€‚<br />
ä¸­èº«ã¯ã¾ã ãªã„ã€‚<br />
ãã£ã¨é…’ã¨ãƒ¡ã‚·ã«ã¤ã„ã¦ã®ä½•ã‹ãŒæ›¸ã‹ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã€‚</p>


<figure>
    <a href="https://sakemeshi.love/">
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0001.png" />
    </a>
    
</figure>


<p>ã“ã‚Œã¯ãã‚‚ãã‚‚<a href="https://denatechstudio.connpass.com/event/72710/">å…ˆæ—¥é–‹å‚¬ã—ãŸãƒãƒƒã‚«ã‚½ãƒ³</a>ã§ã‚„ã‚ã†ã¨ã—ã¦é€”ä¸­ã¾ã§ã—ã‹é€²ã‚ã‚‰ã‚Œãªã‹ã£ãŸã®ã§ã€ãã®è£œç¿’ã‚‚å…¼ã­ã¦ã¾ã™ã€‚<br />
ãªãŠæ¬¡å›ãƒãƒƒã‚«ã‚½ãƒ³ã¯Goã§ã™ï¼</p>

<p><a href="https://denatechstudio.connpass.com/event/75706/">DeNA Techathon: è‘—è€…ã¨å­¦ã¶ã€ŒGoãªã‚‰ã‚ã‹ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€é»™ã€…ä¼š - connpass</a></p>

<h2 id="æ§‹æˆ">æ§‹æˆ</h2>

<p>å›³ã‚’æãæ°—åŠ›ãŒãªã‹ã£ãŸã®ã§ãƒ†ã‚­ã‚¹ãƒˆã§ã€‚</p>

<h3 id="ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ç·¨">ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ç·¨</h3>

<p><a href="https://www.terraform.io/">Terraform</a>ã§ä»¥ä¸‹ã‚’è¡Œãªã£ã¦ã„ã‚‹ã€‚</p>

<ol>
<li>Route 53ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</li>
<li>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°ç”¨ã®IAMã‚°ãƒ«ãƒ¼ãƒ—ã¨IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‰•ã„å‡ºã™</li>
<li>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ ¼ç´ç”¨ã®S3ãƒã‚±ãƒƒãƒˆã‚’ä½œã‚‹</li>
<li>ACMã§SSL/TLSè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã™ã‚‹</li>
<li>CloudFront distributionã‚’è¨­å®šã™ã‚‹(ACMã®è¨¼æ˜æ›¸ä½¿ã„ãŸã„ã®ã§)</li>
<li>CloudFront distributionã‚’Route 53ã«ç™»éŒ²ã™ã‚‹</li>
</ol>

<h3 id="ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°ç·¨">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°ç·¨</h3>

<p>GitHubã¸ã®pushã‚’ãƒˆãƒªã‚¬ãƒ¼ã«<a href="https://circleci.com/">CircleCI</a>ã§ä»¥ä¸‹ã‚’è¡Œãªã£ã¦ã„ã‚‹ã€‚</p>

<ol>
<li>Hugoã§staticãªWebã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆã™ã‚‹</li>
<li>ç”Ÿæˆã—ãŸWebã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’S3ã«åŒæœŸã™ã‚‹</li>
<li>CloudFrontã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹</li>
</ol>

<h3 id="github">GitHub</h3>

<p><a href="https://github.com/">GitHub</a>ã§ä»¥ä¸‹ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã€‚</p>

<ul>
<li><a href="https://github.com/mazgi/sakemeshi.terraform">sakemeshi.terraform</a>

<ul>
<li>Terraformãƒªãƒã‚¸ãƒˆãƒª</li>
<li>ä¸­èº«ã¯Route 53ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¾ãƒ¼ãƒ³ã‚’ç™»éŒ²ã—ã¦moduleã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ãã‚‰ã„</li>
<li>AWSã®credentialç­‰ã¯ <code>sakemeshi.terraform-secret</code> ãƒªãƒã‚¸ãƒˆãƒªã«ç½®ã„ã¦submoduleã¨ã—ã¦å‚ç…§ã—ã¦ã„ã‚‹</li>
</ul></li>
<li><a href="https://github.com/mazgi/terraform-aws-static-website">terraform-aws-static-website</a>

<ul>
<li>è‡ªåˆ†ç”¨Terraform module</li>
<li>S3+CloudFrontã§staticãªWebã‚µã‚¤ãƒˆã‚’ä½œã‚‹ã‚‚ã‚ã‚‚ã‚ãŒè©°ã¾ã£ã¦ã„ã‚‹</li>
</ul></li>
<li>(private) sakemeshi.terraform-secret

<ul>
<li>AWSã®credentialãªã©ãŒå…¥ã£ã¦ã„ã‚‹</li>
<li>credential storeå°å…¥ã¨ã‹ã¯ã¾ãŸä»Šåº¦</li>
</ul></li>
<li>(private) sakemeshi.content

<ul>
<li>Hugoã«ã‚ˆã‚‹Webã‚µã‚¤ãƒˆã®ä¸­èº«</li>
<li>ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®masterã«pushã™ã‚‹ã¨CircleCIãŒå‹•ã„ã¦S3ã«deployã•ã‚Œã‚‹</li>
</ul></li>
</ul>

<h1 id="ã¤ãã‚Šã‹ãŸ">ã¤ãã‚Šã‹ãŸ</h1>

<p>ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã—ã¦ã¯WebUIã‚’æ‰‹ã§ã½ã¡ã½ã¡ã—ãŸããªã„ã®ã§Terraformã§Infra as Codeã—ã¾ã™ï¼</p>

<h2 id="aws-webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã½ã¡ã½ã¡">AWS Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã½ã¡ã½ã¡</h2>

<p>æœ€åˆã‹ã‚‰ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åã™ã‚‹ã‚ˆã†ã ãŒ2018å¹´æ™‚ç‚¹ã§ã¯æ‰‹ã§ãƒãƒãƒãƒã™ã‚‹ã“ã¨ã‚‚ã¾ã å¿…è¦ãªã®ã§ã™ã€‚(ã‚ã‚‹ã„ã¯CLI)<br />
ä½œã‚‹ã‚‚ã®ã¯2ã¤ã€‚</p>

<h3 id="terraform-å®Ÿè¡Œç”¨-iam-user">Terraform å®Ÿè¡Œç”¨ IAM User</h3>

<p><code>terraform-admin</code> ã¨ã„ã†åå‰ã§ <code>AdministratorAccess</code> ã‚’attacheã—ãŸIAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œã‚‹ã€‚<br />
credentialã‚‚æ‰•ã„å‡ºã—ã¦ã€ä»Šå›ã®å ´åˆã¯ <code>sakemeshi.terraform-secret</code> ãƒªãƒã‚¸ãƒˆãƒªã«pushã—ã¦ãŠãã€‚</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0002.png" />
    
    
</figure>


<h3 id="tfstate-æ ¼ç´ç”¨-s3-bucket">tfstate æ ¼ç´ç”¨ S3 Bucket</h3>

<p>Terraformã¯è¨­å®šã—ãŸã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã®çŠ¶æ…‹ã‚’ <code>tfstate</code> ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹ã®ã§ãã‚Œã‚’æ ¼ç´ã™ã‚‹S3ãƒã‚±ãƒƒãƒˆã‚’ä½œã‚‹ã€‚</p>

<p>ãƒã‚±ãƒƒãƒˆåã¯ <code>${AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå}-terraform</code> ã¨ã—ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚<br />
å…ˆã»ã©ä½œã£ãŸIAMãƒ¦ãƒ¼ã‚¶ãƒ¼ <code>terraform-admin</code> ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚Œã°è‰¯ã„ã€‚</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0003.png" />
    
    
</figure>


<p>è©³ã—ãã¯ä»¥ä¸‹å‚ç…§ã€‚</p>

<p><a href="https://www.terraform.io/docs/backends/types/s3.html">Backend Type: s3 - Terraform by HashiCorp</a></p>

<h2 id="infra-as-terraform">Infra as Terraform</h2>

<h3 id="ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ã">ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ã</h3>

<p>Terraformã§æ§‹ç¯‰ã™ã‚‹ã‚‚ã‚ã‚‚ã‚ã¯å°‚ç”¨ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦ <code>terraform.tf</code> ã«æ›¸ãã€‚<br />
å…ˆè¿°ã®é€šã‚Šã“ã“ã§å…¬é–‹ã—ã¦ã„ã‚‹ã€‚</p>

<p><a href="https://github.com/mazgi/sakemeshi.terraform">mazgi/sakemeshi.terraform</a></p>

<p>ä¸»ãªå†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚</p>

<ul>
<li><code>prepare.sh</code>

<ul>
<li>terraformãƒã‚¤ãƒŠãƒªã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å±•é–‹</li>
<li>å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã®export</li>
<li>ãªãŠå‘½åã¯è·å ´ã®æ–‡åŒ–ã«ç”±æ¥ã™ã‚‹</li>
</ul></li>
<li><code>terraform.tf</code>

<ul>
<li>Terraformã§è¡Œã„ãŸã„ã‚‚ã‚ã‚‚ã‚</li>
<li>ãŸã ã—ã»ã¨ã‚“ã©ã¯moduleã«è¿½ã„å‡ºã—ã¦ã„ã‚‹ã®ã§ã€å®Ÿéš›ã®å†…å®¹ã¯Route 53ã®ã‚¾ãƒ¼ãƒ³è¨­å®šã¨moduleã®èª­ã¿å‡ºã—ç¨‹åº¦</li>
</ul></li>
<li><code>terraform.tfvars</code>

<ul>
<li>å¾Œè¿°ã®privateãªcredentialãƒªãƒã‚¸ãƒˆãƒªå†…ã¸ã®symlink</li>
<li>AWSã®ACCESS_KEYã‚„SECRET_KEYãªã©ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹</li>
</ul></li>
</ul>

<p><code>terraform.tf</code> ã§å‚ç…§ã—ã¦ã„ã‚‹moduleã¯å…¬é–‹ã—ã¦ã„ã‚‹ãŒå¾Œè¿°ã®ã‚¨ãƒ©ãƒ¼ã‚„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒå›ºå®šãªã©ã®æ®‹èª²é¡ŒãŒã‚ã‚‹ã€‚</p>

<p><a href="https://registry.terraform.io/modules/mazgi/static-website/aws/0.0.2">Terraform Module Registry | mazgi/static-website/aws</a></p>

<p>å…ˆè¿°ã®é€šã‚ŠTerraformã‚’å®Ÿè¡Œã™ã‚‹IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã®credentialç­‰ã¯åˆ¥ã®privateãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦é…ç½®ã—ã¦ã„ã‚‹ã€‚<br />
å…¬é–‹ã§ããªã„ãŒä¸­èº«ã¯ã“ã®ç¨‹åº¦ã€‚</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0004.png" />
    
    
</figure>


<h3 id="terraform-å®Ÿè¡Œ">Terraform å®Ÿè¡Œ</h3>

<p>ã‚ˆã†ã‚„ãTerraformã‚’å®Ÿè¡Œã§ãã‚‹ç’°å¢ƒãŒæ•´ã£ãŸã®ã§å®Ÿè¡Œï¼<br />
ãªãŠ <code>prepare.sh</code> ã¯ç’°å¢ƒå¤‰æ•°ã‚’exportã™ã‚‹ã®ã§å¿…ãš <code>source</code> ã™ã‚‹ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ source prepare.sh
$ bin/terraform apply</code></pre></div>

<p>å®Ÿè¡Œã™ã‚‹ã¨åˆå›ã¯ã‚‚ã‚ã‚‚ã‚ã®ãƒªã‚½ãƒ¼ã‚¹ãŒä½œã‚‰ã‚Œã€1ä»¶ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚<br />
2å›ç›®ä»¥é™ã¯ã“ã®ã‚ˆã†ã«1ä»¶ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚ã€‚<br />
å¾Œè¿°ã™ã‚‹ã€‚</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0005.png" />
    
    
</figure>


<p>ç´°ã‹ã„ã“ã¨ã‚’æ›¸ãã¨ä»Šå›ã®ãƒ‰ãƒ¡ã‚¤ãƒ³è‡ªä½“ã¯Route 53ã§ç®¡ç†ã—ã¦ã„ãªã„ãŸã‚ã€åˆ¥é€”ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã‚’Route 53ã«å‘ã‘ã¦ãŠãç­‰ã®æ‰‹é †ãŒå¿…è¦ã§ã™ã€‚</p>

<h2 id="circleciã§è‡ªå‹•build-deploy">CircleCIã§è‡ªå‹•build &amp;&amp; deploy</h2>

<p>Terraformã§ç©ºã®Webã‚µã‚¤ãƒˆãŒã§ããŸã®ã§ä¸­èº«ã‚’ä½œã£ã¦ã„ãã€‚</p>

<p>GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨æ„ã—ã¦ãŠã‚‚ã‚€ã‚ã« <code>hugo new site .</code> ã™ã‚‹ã€‚<br />
é©å½“ãªãƒ†ãƒ¼ãƒã‚’submoduleã¨ã—ã¦è¿½åŠ ã™ã‚‹ã€‚<br />
<a href="https://gohugo.io/getting-started/quick-start/">Quick Start</a>é€šã‚Šã€‚</p>

<p>Hugoã¯ä»Šå¾ŒãŒã‚“ã°ã‚‹ã“ã¨ã«ã—ã¦ä»Šå›ã¯CircleCI 2.0ã‚’ãŒã‚“ã°ã‚‹ã€‚<br />
çµè«–ã‚’æ›¸ãã¨<a href="https://gist.github.com/mazgi/6c0dd922f89eee80fe5da6317d7e7aed">ã“ã†ã„ã† <code>.circleci/config.yml</code> </a>ã‚’æ›¸ã„ãŸã€‚<br />
ãƒãƒã£ãŸã€‚</p>

<p>ãã®ã»ã‹ã¯æœ¬å½“ã« <code>hugo new site .</code> ã—ãŸã¾ã¾ã€‚</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0006.png" />
    
    
</figure>


<p>ä½•ã¯ã¨ã‚‚ã‚ã‚Œã“ã‚Œã§CircleCIã§ã®Webã‚µã‚¤ãƒˆã®ãƒ“ãƒ«ãƒ‰ã¨S3ã¸ã®åŒæœŸãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ã‚ã§ãŸã„ï¼</p>


<figure>
    
        <img src="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/0007.png" />
    
    
</figure>


<h1 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h1>

<p>ã¨ã„ã†ã“ã¨ã§(ã»ã¼)æ‰‹ã§ã½ã¡ã½ã¡ã›ãšã«Infrastructure as Codeã§staticãªWebã‚µã‚¤ãƒˆãŒä½œã‚ŒãŸã—æ›´æ–°ã®ä»•çµ„ã¿ã‚‚ã§ããŸï¼ã‚„ã£ãŸã­ï¼</p>

<h2 id="ãƒã‚¤ãƒ³ãƒˆ">ãƒã‚¤ãƒ³ãƒˆ</h2>

<p>ä»¥ä¸‹ã‚ã¾ã‚Šæ›¸ã‘ã¦ãªã„ã®ã§æ©Ÿä¼šãŒã‚ã£ãŸã‚‰æ›¸ãã€‚</p>

<h3 id="terraform">Terraform</h3>

<ul>
<li>æœ€è¿‘ã®Terraformã¯ <code>terraform init</code> ãŒå¿…è¦

<ul>
<li>ãã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã®åˆå›å®Ÿè¡Œã‚„moduleã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸Šã’ãŸéš›ãªã©</li>
</ul></li>
<li>æœ€è¿‘ã®Terraformã¯ <code>terraform apply</code> ã—ãŸã‚ã¨æœ¬å½“ã«å®Ÿè¡Œã™ã‚‹ã‹èã„ã¦ãã‚‹

<ul>
<li>ãã®ãŸã‚ <code>terraform apply[ENTER]</code> ã—ã¦ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’è²·ã„ã«ã„ãã¨ä½•ååˆ†å¾Œã«æˆ»ã£ã¦ã‚‚ <code>Do you want to perform these actions?</code> ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºè¿ãˆã¦ãã‚Œã‚‹(ã‚‚ã¡ã‚ã‚“ã‚ãªãŸã®ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã«ã¯ä½•ã‚‚å¤‰åŒ–ã¯ãªã„)</li>
<li><code>terraform apply -auto-approve</code> ã¨ã„ã†ã‚ã‚‹ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹</li>
</ul></li>
<li>tfstateæ ¼ç´ç”¨S3ãƒã‚±ãƒƒãƒˆ(S3 backend)ã‚’ä½¿ã†ãŸã‚ã«ã¯ç’°å¢ƒå¤‰æ•°or <code>~/.aws</code> å†…ã«credentialãŒå¿…è¦

<ul>
<li>ç§ã¯ <code>prepare.sh</code> ã®ä¸­ã§exportã—ã¦ã„ã‚‹(ã®ã§å¿…ãš <code>source</code> ã™ã‚‹)</li>
</ul></li>
<li>ACMã®æ¤œè¨¼ãŒå¾“æ¥ã®ãƒ¡ãƒ¼ãƒ«ã ã‘ã§ã¯ãªãDNSã§ã‚‚ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¦Terraformã§ã‚‚å¯¾å¿œã—ã¦ã„ãŸ

<ul>
<li><a href="https://github.com/terraform-providers/terraform-provider-aws/pull/2813">New Resources: aws_acm_certificate and aws_acm_certificate_validation by flosell Â· Pull Request #2813 Â· terraform-providers/terraform-provider-aws</a></li>
<li>ã“ã‚Œã®ãŠã‹ã’ã§ <code>terraform apply</code> ã ã‘ã§è¨¼æ˜æ›¸ç™ºè¡Œã—ã¦Issuedã«ãªã‚‹ã¨ã“ã‚ã¾ã§å®Ÿç¾ã§ããŸ</li>
<li>ãŸã ã—<a href="https://github.com/mazgi/terraform-aws-static-website/blob/v0.0.2/main.tf#L9"> <code>AWS provider 1.9</code> ä»¥ä¸ŠãŒå¿…è¦</a></li>
</ul></li>
</ul>

<h3 id="circleci-2-0">CircleCI 2.0</h3>

<ul>
<li>Dockerä¾¿åˆ©ã ã‘ã©ã‚‚

<ul>
<li>ä½¿ã†Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚‚ã‚ˆã‚‹ãŒå½“ç„¶ <code>curl</code> ã‚‚ <code>git</code> ã‚‚å…¥ã£ã¦ãªã‹ã£ãŸã‚Šã™ã‚‹</li>
<li>è‡ªåˆ†ç”¨Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ä½œã‚ŠãŸããªã‚‹</li>
<li>é–‹ç™ºç’°å¢ƒãŒDocker Hubã«å…¬é–‹ã§ãã‚‹Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã§å®Œçµã—ã¦ã„ã‚‹å ´åˆã¯ä¾¿åˆ©ãã†</li>
</ul></li>
<li><code>checkout</code> ã« <code>git clone --recursive</code> ç›¸å½“ã®æ©Ÿèƒ½ãŒãªã„(?)

<ul>
<li>ãã®ãŸã‚<a href="https://github.com/mazgi/sakemeshi.content/blob/master/.circleci/config.yml#L20-L21"><code>checkout</code> ã®æ¬¡ã®è¡Œã§ <code>git submodule update</code> ã‚’æ›¸ã„ãŸ</a></li>
</ul></li>
</ul>

<h2 id="ç‰¹ã«-ãƒãƒã‚Šã©ã“ã‚">(ç‰¹ã«)ãƒãƒã‚Šã©ã“ã‚</h2>

<h3 id="terraform-apply-æ™‚ã®-aws-acm-certificate-validation-ã‚¨ãƒ©ãƒ¼">terraform apply æ™‚ã® aws_acm_certificate_validation ã‚¨ãƒ©ãƒ¼</h3>

<p><code>terraform apply</code> ã™ã‚‹éš›ã«æ¯å›ã“ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Error: Error applying plan:

<span style="color:#ae81ff">1</span> error<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> occurred:

* module.static-website.aws_acm_certificate_validation.website: <span style="color:#ae81ff">1</span> error<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> occurred:

* aws_acm_certificate_validation.website: Certificate needs <span style="color:#f92672">[</span>VALIDATON_RECORD.YOURDOMAIN VALIDATON_RECORD.YOURDOMAIN<span style="color:#f92672">]</span> to be set but only <span style="color:#f92672">[</span>VALIDATON_RECORD.YOURDOMAIN<span style="color:#f92672">]</span> was passed to validation_record_fqdns</code></pre></div>

<p>ã“ã‚Œ <code>YOURDOMAIN</code> ã¨ <code>*.YOURDOMAIN</code> ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒåŒã˜ã§ã€Route 53ä¸Šã¯1ãƒ¬ã‚³ãƒ¼ãƒ‰ã—ã‹ãªã„ã‚‚ã®ã‚’Terraformã®<a href="https://github.com/terraform-providers/terraform-provider-aws/blob/v1.9.0/aws/resource_aws_acm_certificate_validation.go">AWS provider</a>ãŒ2ãƒ¬ã‚³ãƒ¼ãƒ‰è¿”ã£ã¦ãã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã‚“ã ã‘ã©ã©ã†ã—ãŸã‚‚ã®ã‹ã€‚</p>

<h3 id="circleci-2-0-ã§-attach-workspace-ã™ã‚‹ãŸã‚ã«-ca-certificates-ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦">CircleCI 2.0 ã§ attach_workspace ã™ã‚‹ãŸã‚ã« ca-certificates ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦</h3>

<p>å‰ãƒ•ã‚§ã‚¤ã‚ºã§æ°¸ç¶šåŒ–ã—ãŸãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¾Œãƒ•ã‚§ã‚¤ã‚ºã§ <code>attach_workspace</code> ã—ã¦å–ã‚Šå‡ºã™ãŸã‚ã« <code>ca-certificates</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¿…è¦ãªã®ã¯ãƒãƒã£ãŸã€‚<br />
ã“ã¡ã‚‰ã®è¨˜äº‹ã«åŠ©ã‘ã‚‰ã‚ŒãŸã€‚</p>

<p><a href="https://qiita.com/gcoka/items/8a9cd59fec324a1fca19">CircleCIã§x509ã¨ã„ã†è¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ãŸã¨ãã®å¯¾å‡¦ - Qiita</a></p>

<p>ãã‚Œã¯ãã†ã¨å†æ²ã™ã‚‹ãŒ <code>.circleci/config.yml</code> ãŒã“ã‚“ãªé•·ã•ã«ãªã£ãŸã€‚ã¤ã‚‰ã„ã€‚<br />
workflowã¨ã—ã¦buildã¨deployãŒåˆ†ã‹ã‚Œã‚‹ã®ã¯ç¶ºéº—ã ã‘ã©ã‚‚ã€‚ã€‚</p>

<script src="//gist.github.com/mazgi/6c0dd922f89eee80fe5da6317d7e7aed.js"></script>

<p>ã¨ã‚‚ã‹ãã“ã†ã„ã†ã‚µã‚¤ãƒˆã‚’ã„ãã¤ã‹ä½œã‚ŠãŸã„ãƒ‹ãƒ¼ã‚ºãŒã‚ã£ãŸã®ã§ã‚„ã£ã¦ã„ãã¾ã™ã€‚</p>

    </article>
    
    <hr/>
    
    
    <article>
      <div class="row">
        <h1><a href="/posts/2017.12/technical-docs-with-hugo/">ç°¡æ˜“ãªæŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’Hugoã§æ›¸ãã¨ä¾¿åˆ©ã ã£ãŸ</a></h1>
      </div>
      

<p>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’<a href="https://gohugo.io/">Hugo</a>ã§æ›¸ã„ã¦ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ä¸€ç·’ã«é…ã£ãŸã‚‰ä¾¿åˆ©ãã†ã ã£ãŸã®ã§ã‚„ã£ã¦ã¿ãŸã€‚</p>

<h2 id="ã‚„ã‚ŠãŸã„ã“ã¨">ã‚„ã‚ŠãŸã„ã“ã¨</h2>

<p>ä»•äº‹ã§ä»–ç¤¾ã•ã‚“ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚»ãƒƒãƒˆã§ãŠæ¸¡ã—ã—ãŸã„ã®ã ã‘ã©ç¤¾ã§ã¯GitHub Enterpriseã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ç›´æ¥è¦‹ã¦ã„ãŸã ãã“ã¨ãŒé›£ã—ã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ã€‚</p>

<p>è¦æ¨¡ãŒå¤§ãã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰<a href="http://www.sphinx-doc.org/">Sphinx</a>ä½¿ã†ã¨(ã‚„ã‚‹æ°—æ¬¡ç¬¬ã§)ã„ãã‚‰ã§ã‚‚ç¶ºéº—ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›¸ã‘ãã†ã§ã¯ã‚ã‚‹ã‘ã©ã€è¦æ¨¡ãŒãã‚Œã»ã©ã˜ã‚ƒãªã„ã†ã¡ã¯ã‚µã‚¯ãƒƒã¨Markdownã§æ›¸ã„ã¦ã€ã§ã‚‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ•´åˆæ€§å–ã‚Œã¦ã¦ã»ã—ã„ã¨ã„ã†æ°—æŒã¡ã«ãªã‚‹ã€‚<br />
(ä»Šã¯<a href="http://www.sphinx-doc.org/en/stable/markdown.html">Sphinxã‚‚Markdownã§æ›¸ã‘ã‚‹</a>ãã†ã ã€æœ€è¿‘çŸ¥ã£ãŸ)</p>

<p>ãã‚‚ãã‚‚(ç§ã¯)ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›¸ããŸããªã„ã®ã§ã€ã§ãã‚‹ã ã‘ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æä¾›ã‚„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆã§è³„ã£ã¦æ–‡ç« é‡ã¯æœ€å°é™ã«æŠ‘ãˆãŸã„ã¨ã„ã†ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã‚ã£ãŸã€‚</p>

<p>ãã“ã§ä»¥ä¸‹ã®ã‚ˆã†ãªä½œæˆ¦ã‚’è€ƒãˆãŸã€‚</p>

<h3 id="ã•ãã›ã‚“">ã•ãã›ã‚“</h3>

<ul>
<li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯Hugoã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãªãŒã‚‰Markdownã§æ›¸ã</li>
<li>ç”Ÿæˆã—ãŸHTMLã¯ <code>/docs</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«çªã£è¾¼ã‚€</li>
<li>ç¤¾å†…å‘ã‘ã«ã¯GitHub Pagesã§masterã®HEADã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹</li>
<li>ç¤¾å¤–å‘ã‘ã«ã¯æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’æä¾›ã™ã‚‹</li>
</ul>

<p>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‹ã‚‰æ›¸ãã®æ¥½ã ã—ã€tagæ‰“ã¦ã‚‹ã‹ã‚‰ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ•´åˆæ€§ã‚‚å–ã‚Šã‚„ã™ã„ã€‚ãã£ã¨ä¾¿åˆ©ï¼</p>

<h2 id="ã§ããŸã‚‚ã®">ã§ããŸã‚‚ã®</h2>

<ul>
<li>ãƒªãƒã‚¸ãƒˆãƒª: <a href="https://github.com/mazgi/example-document-with-hugo">https://github.com/mazgi/example-document-with-hugo</a></li>
<li>GitHub Pages: <a href="https://mazgi.github.io/example-document-with-hugo/index.html">https://mazgi.github.io/example-document-with-hugo/index.html</a></li>
</ul>

<p>ãƒ†ãƒ¼ãƒã¯ã“ã¡ã‚‰ã‚’ä½¿ã‚ã›ã¦ã„ãŸã ã„ãŸã€‚<br />
ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã‚¨ãƒ³ãƒˆãƒªãŒä¸€è¦§ã§ãã¦æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‰ã—ã•ãŒã‚ã‚‹ã€‚<br />
<a href="https://github.com/vjeantet/hugo-theme-docdock">https://github.com/vjeantet/hugo-theme-docdock</a></p>

<h2 id="å·¥å¤«">å·¥å¤«</h2>

<p><a href="https://github.com/mazgi/example-document-with-hugo/blob/master/docs.source/config.toml">è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã‚Œã€‚</a></p>

<ul>
<li>ä»¥ä¸‹ã§ç”Ÿæˆã—ãŸHTMLå†…ã®ãƒªãƒ³ã‚¯ãŒ <code>/</code> ã‹ã‚‰ã®ç›¸å¯¾PATHã«ãªã‚‹ãµã„ã‚“ã(ã¡ã‚ƒã‚“ã¨èª¿ã¹ã¦ã„ãªã„)

<ul>
<li><code>baseURL = &quot;/&quot;</code></li>
<li><code>relativeURLs = true</code></li>
<li><code>uglyurls = true</code></li>
</ul></li>
<li>themeã®æŒ‡å®š</li>
</ul>

<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 1</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 2</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 3</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 4</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 5</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 6</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 7</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 8</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79"> 9</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79">10</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;display:block;color:#7c7c79">11</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#a6e22e">baseURL</span> = <span style="color:#e6db74">&#34;/&#34;</span>
<span style="color:#a6e22e">languageCode</span> = <span style="color:#e6db74">&#34;en-us&#34;</span>
<span style="color:#a6e22e">DefaultContentLanguage</span> = <span style="color:#e6db74">&#34;en&#34;</span>
<span style="color:#a6e22e">title</span> = <span style="color:#e6db74">&#34;Example Document with Hugo&#34;</span>
<span style="color:#a6e22e">publishDir</span> = <span style="color:#e6db74">&#34;../docs&#34;</span>
<span style="color:#a6e22e">relativeURLs</span> = <span style="color:#66d9ef">true</span>
<span style="color:#a6e22e">uglyurls</span> = <span style="color:#66d9ef">true</span>
<span style="color:#a6e22e">theme</span> = <span style="color:#e6db74">&#34;docdock&#34;</span>

[<span style="color:#a6e22e">params</span>]
<span style="color:#a6e22e">themeVariant</span> = <span style="color:#e6db74">&#34;gray&#34;</span></code></pre></td></tr></table>
</div>
</div>

<p>ã¾ãŸã€ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰(Markdownä»–)ã‚’ <code>/docs.source</code> ã«ç½®ãã€ <code>publishDir = &quot;../docs&quot;</code> ã¨è¨­å®šã™ã‚‹ã“ã¨ã§ãƒªãƒã‚¸ãƒˆãƒªã®rootã«ã‚ã¾ã‚Šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã‹ãªã„ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚<br />
ã“ã‚Œã¯ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚åŒå±…ã™ã‚‹æƒ³å®šã§ã‚ã‚Šã€rootã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¢—ãˆã¦è¦‹é€šã—ãŒã‚ã‚‹ããªã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹ãŸã‚ã€‚</p>

<p>HTMLã‚’ç”Ÿæˆã—ã¦commitã—ã¦pushã—ã¦tagã‚’æ‰“ã£ãŸã‚‚ã®ãŒã“ã¡ã‚‰ã€‚<br />
<a href="https://github.com/mazgi/example-document-with-hugo/releases/tag/v0.0.1">https://github.com/mazgi/example-document-with-hugo/releases/tag/v0.0.1</a></p>

<p>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ‰‹å…ƒã§é–‹ãã¨ã“ã‚“ãªæ„Ÿã˜ã§ <code>index.html</code> ãŒè¦‹ãˆã‚‹ã€‚<br />
ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚å±•é–‹å¾Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒŠãƒ³ãƒãƒ¼ãŒå«ã¾ã‚Œã‚ã‹ã‚Šã‚„ã™ã„ã€‚</p>


<figure>
    
        <img src="/posts/2017.12/technical-docs-with-hugo/0001.png" />
    
    
</figure>


<p><code>index.html</code> ã‚‚ãƒªãƒ³ã‚¯å…ˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºã§ãã‚‹ã€‚ä¾¿åˆ©ã€‚</p>


<figure>
    
        <img src="/posts/2017.12/technical-docs-with-hugo/0002.png" />
    
    
</figure>


    </article>
    
    <hr/>
    
    
    <article>
      <div class="row">
        <h1><a href="/posts/2017.12/dockerimage-for-chainermn-on-v100/">EC2 P3ã§ä½¿ãˆã‚‹ChainerMNå…¥ã‚Šã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ãŸ</a></h1>
      </div>
      

<p>sonotså…ˆç”Ÿã«ã‚ˆã‚‹ã“ã®è¨˜äº‹ã‚’ã‚„ã£ã¦ã¿ãŸã¨ã„ã†è©±ã§ã™ã€‚</p>

<p><a href="https://qiita.com/sonots/items/ee247a2e36033646c914">docker (nvidia-docker) ã‚’ä½¿ã£ã¦ãƒãƒ«ãƒãƒãƒ¼ãƒ‰ã§ ChainerMN ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•(ä»®) - Qiita</a></p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>

<p>Dockerfileã¯ã“ã“ã«ã‚ã‚Šã¾ã™ã€‚</p>

<p><a href="https://github.com/mazgi/docker-cuda-cv">mazgi/docker-cuda-cv: based on: https://gitlab.com/nvidia/cuda</a></p>

<p>ãƒ™ãƒ¼ã‚¹ã¯NVIDIAã•ã‚“ã®ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚</p>

<p><a href="https://hub.docker.com/r/nvidia/cuda/">https://hub.docker.com/r/nvidia/cuda/</a></p>

<h2 id="å®Ÿè¡Œçµæœ">å®Ÿè¡Œçµæœ</h2>

<p>ChainerMNã®exampleã‚’è©¦ã—ãŸçµæœã¯ã“ã¡ã‚‰ã€‚<br />
ä»Šã®ã¨ã“ã‚ã‚·ãƒ³ã‚°ãƒ«Nodeã‚·ãƒ³ã‚°ãƒ«GPUã¨ã‚·ãƒ³ã‚°ãƒ«Nodeãƒãƒ«ãƒGPUã—ã‹è©¦ã—ã¦ãªã„ã§ã™ã€‚</p>

<script src="//gist.github.com/mazgi/e095e4756f14ebb9db5c26cd70b23c63.js"></script>

<p>æ‰‹é †ã¯ã“ã¡ã‚‰ã®é€šã‚Šãªã‚“ã§ã™ãŒæ™‚é–“ãŒå–ã‚Œã¦ã„ãªã„&hellip;</p>

<p><a href="https://qiita.com/sonots/items/ee247a2e36033646c914#%E3%83%9E%E3%83%AB%E3%83%81%E3%83%8E%E3%83%BC%E3%83%89">docker (nvidia-docker) ã‚’ä½¿ã£ã¦ãƒãƒ«ãƒãƒãƒ¼ãƒ‰ã§ ChainerMN ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•(ä»®) - Qiita</a></p>

<p>P3ã˜ã‚ƒãªãã¦ã‚‚å‹•ãã¯ãšã§ã™ãŒã€ãƒ›ã‚¹ãƒˆå´ã«GPUã¨nvidia-dockerã¯å¿…è¦ã§ã™ã€‚<br />
ä»Šå›ã¯ç¤¾ã®ç’°å¢ƒã§è©¦ã—ãŸã®ã§sonotsä¾¿åˆ©å…ˆç”Ÿç’°å¢ƒã®æ©æµã‚’å—ã‘ã¦ã¾ã™ğŸ™</p>

<p><a href="http://blog.livedoor.jp/sonots/archives/49502478.html">DeNA TechCon 2017 ã¨ Developers Summit 2017 ã§DeNAã®æ©Ÿæ¢°å­¦ç¿’åŸºç›¤ã¨åˆ†æåŸºç›¤ã®è¬›æ¼”ã‚’ã—ã¾ã—ãŸ - sonots:blog</a></p>

<p>ã‚¤ãƒã‹ã‚‰æ§‹ç¯‰ã™ã‚‹å ´åˆã¯ã“ã†ã„ã†è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šãã†ã€‚</p>

<p><a href="http://chie8842.hatenablog.com/entry/2017/11/27/221551">p3ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹(V100)ä¸Šã§CUDA+CUDNN+Tensorflowã‚’å‹•ã‹ã™ã®ãŒå¤§å¤‰ã ã£ãŸã®ã§ãã‚ãã€‚ - ç„¼è‚‰ãŒé£Ÿã¹ãŸã„</a></p>

<h2 id="çµŒç·¯ã¨ã‹">çµŒç·¯ã¨ã‹</h2>

<p>ã‚ã§ãŸãè¨˜äº‹ã‚‚å‡ºãŸã®ã§è‰²ã€…è¨€ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã™ãŒã€å®Ÿã¯ã‚ã‚ŠãŒãŸã„ã“ã¨ã«P3ã®å…ˆè¡Œæ¤œè¨¼ã¨ã„ã†ã®ã‚’ã•ã›ã¦ã„ãŸã ã„ã¦ã¾ã—ãŸã€‚<br />
(ãªãŠã‚¤ãƒ™ãƒ³ãƒˆå½“æ—¥ã¯ã‚«ãƒ¡ãƒ©ãƒãƒ³ã—ã¦ã¾ã—ãŸ)</p>

<p><a href="https://engineer.dena.jp/2017/12/amazon-ec2-p3pose-estimation.html">Amazon EC2 P3ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãŠã‘ã‚‹Pose Estimationé€Ÿåº¦å‘ä¸Šæ¤œè¨¼ - Technology of DeNA</a></p>

<p>ã“ã®æ¤œè¨¼æ™‚ç‚¹ã§ã¯ChainerMNã§ã¯ãªãChainerã§ã€ç’°å¢ƒã‚‚VMä¸Šã«ç›´æ¥ä½œã£ã¦ãŸã®ã§ã™ãŒã€ãã®å¾Œéƒ¨å†…ã‹ã‚‰ã€ŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã£ã¦ãŸã»ã†ãŒä¾¿åˆ©ã€ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã„ãŸã ãå…ˆè¡Œè€…ã®è¨˜äº‹ã‚’å‚è€ƒã«æ‰‹æ¢ã‚Šã—ã¦ã‚‹çŠ¶æ³ã§ã™ã€‚<br />
ç§ã¯MLã‚ã‹ã‚‰ãªã„ãƒãƒ³ãªã®ã§ã™ãŒã€æœ€åˆ cuDNN 7 + CuPy 1.0.3 ã§ç’°å¢ƒä½œã‚ã†ã¨ã—ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒåˆã‚ãªãã¦ã©ã†ã—ã‚ˆï¼ã¨æ€ã£ã¦ãŸã‚‰ã€Œä»Šæ—¥ cuDNN 7 å¯¾å¿œã® CuPy 2.0 ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã‚ˆï¼ã€ã¨æ•™ãˆã¦ã„ãŸã ã„ãŸã‚Šã¨ã‹ã€ã“ã®æ¥­ç•Œæœ¬å½“ã«æ•°æ™‚é–“å˜ä½ã§é€²æ­©ã—ã¦ã¦ã™ã”ã„ã€‚</p>

<p>ã“ã†ã„ã†ç”¨é€”ã ã¨ã‚³ãƒ³ãƒ†ãƒŠã»ã‚“ã¨ä¾¿åˆ©ãªã‚“ã§ã™ã‘ã©ã€ã§ã‚‚Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‘½åã‚€ãšã‹ã—ã„ã€‚<br />
<code>mazgi/cuda-cv:9.0-cudnn7-devel-ubuntu16.04</code> ã˜ã‚ƒãªãã¦ã€<br />
<code>mazgi/cuda-cv-9.0-cudnn7-devel-ubuntu16.04:latest</code> ã¨ã‹ã«ã—ãŸã»ã†ãŒã„ã„ã®ã‹ãª(é•·ã„)ã€‚<br />
ãã‚‚ãã‚‚ã®è©±ã¨ã—ã¦ã¯å®Ÿè³ªChainer &amp; ChainerMNã‚¤ãƒ¡ãƒ¼ã‚¸ãªã®ã§ãã†ã„ã†åå‰ã«ã™ã¹ãã ã—(ã•ã‚‰ã«é•·ããªã‚‹)ã€‚</p>

    </article>
    
    
  </div>
  <div class="col-lg-3">
    <ul>
      
      <li><a href="/posts/2018.03/setup-amazon-sagemaker/">Amazon SageMakerã‚’ãã‚Œãªã‚Šã®äººæ•°ã§ä½¿ã†ã¨ãã®è¨­å®š</a></li>
      
      <li><a href="/posts/2018.03/s3fs-for-s3-with-sse-kms/">SSE-KMSã§æš—å·åŒ–ã—ãŸS3ãƒã‚±ãƒƒãƒˆã‚’s3fsã§mountã™ã‚‹</a></li>
      
      <li><a href="/posts/2018.02/s3&#43;cloudfront-website-with-terraform-and-circleci/">S3&#43;CloudFrontã‚’Terraformã§è¨­å®šã—ã¦CircleCIã§æ›´æ–°ã™ã‚‹</a></li>
      
      <li><a href="/posts/2017.12/technical-docs-with-hugo/">ç°¡æ˜“ãªæŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’Hugoã§æ›¸ãã¨ä¾¿åˆ©ã ã£ãŸ</a></li>
      
      <li><a href="/posts/2017.12/dockerimage-for-chainermn-on-v100/">EC2 P3ã§ä½¿ãˆã‚‹ChainerMNå…¥ã‚Šã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ãŸ</a></li>
      
    </ul>
  </div>
</div>
      <div class="row">
        <footer class="col-lg-12">
          <hr/>
          <span>&copy; mazgi.log</span>
          <span>&nbsp;&middot;&nbsp;</span>
          <i class="fas fa-bolt"></i>
          <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
        </footer>
      </div>
    </div>
    </main>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68170979-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68170979-2');
    </script>
    
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
  </body>
</html>

