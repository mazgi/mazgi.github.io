<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="/common/favicon.ico">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/common/site.css">
    
    
    <title>mazgi.log :: 「GCPUG Tokyo December 2019」でお話させていただきました</title>
    <meta property="og:title"       content="mazgi.log :: 「GCPUG Tokyo December 2019」でお話させていただきました" />
    <meta property="og:type"        content="article" />
    
    <meta property="og:url"         content="https://mazgi.github.io/posts/2019.12/went-to-gcpug-tokyo-dec-2019/" />
    
      
      <meta property="og:description" content="mazgi&#39;s tech blog" />
      
    
    
    
    
    
    
    
    
    
    
    <meta property="og:image"       content="https://mazgi.github.io/posts/2019.12/went-to-gcpug-tokyo-dec-2019/og.jpeg" />
    <meta property="twitter:image"  content="https://mazgi.github.io/posts/2019.12/went-to-gcpug-tokyo-dec-2019/og.jpeg" />
    <meta property="twitter:image:src"  content="https://mazgi.github.io/posts/2019.12/went-to-gcpug-tokyo-dec-2019/og.jpeg" />
    
    
    <meta name="twitter:card"       content="summary" />
    
    
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      
      <span class="navbar-text mr-1">I am on</span>
      
      <ul class="navbar-nav">
        
        <li class="nav-item">
          <a class="nav-link" target="github_mazgi" href="https://github.com/mazgi">GitHub<i class="ml-1 fab fa-github"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="twitter_mazgi" href="https://twitter.com/@mazgi">Twitter<i class="ml-1 fab fa-twitter"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="instagram_mazgi" href="https://www.instagram.com/mazgi">Instagram<i class="ml-1 fab fa-instagram"></i></a>
        </li>
        
        
      </ul>
    </header>
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://mazgi.github.io/">mazgi.log</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_nav" aria-controls="navbar_nav" aria-expand="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_nav">
        
        <ul class="navbar-nav mr-auto">
          
          
          
          <li class="nav-item">
            <span class="nav-link disabled">Created At: 2019.12.18</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">Updated At: 2020.01.29</span>
          </li>
          
        </ul>
        
        <div class="navbar-nav ml-auto">
          <span class="navbar-text mr-1">share this page via</span>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/share?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2019.12%2fwent-to-gcpug-tokyo-dec-2019%2f&text=%e3%80%8cGCPUG%20Tokyo%20December%202019%e3%80%8d%e3%81%a7%e3%81%8a%e8%a9%b1%e3%81%95%e3%81%9b%e3%81%a6%e3%81%84%e3%81%9f%e3%81%a0%e3%81%8d%e3%81%be%e3%81%97%e3%81%9f" target="_blank"><i class="fab fa-twitter"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmazgi.github.io%2fposts%2f2019.12%2fwent-to-gcpug-tokyo-dec-2019%2f" target="_blank"><i class="fab fa-facebook"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2019.12%2fwent-to-gcpug-tokyo-dec-2019%2f&title=%e3%80%8cGCPUG%20Tokyo%20December%202019%e3%80%8d%e3%81%a7%e3%81%8a%e8%a9%b1%e3%81%95%e3%81%9b%e3%81%a6%e3%81%84%e3%81%9f%e3%81%a0%e3%81%8d%e3%81%be%e3%81%97%e3%81%9f" target="_blank"><i class="fab fa-linkedin"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://plusone.google.com/_/+1/confirm?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2019.12%2fwent-to-gcpug-tokyo-dec-2019%2f" target="_blank"><i class="fab fa-google-plus"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://b.hatena.ne.jp/entry/https://mazgi.github.io/posts/2019.12/went-to-gcpug-tokyo-dec-2019/" target="_blank">b!</a>
            </li>
          </ul>
        </div>
        
      </div>
    </nav>
    <main role="main" class="container-fluid col-lg-10 offset-lg-1">

<div class="row">
  <div class="col-lg-9">
    <article>
      <div class="row">
        <h1>「GCPUG Tokyo December 2019」でお話させていただきました</h1>
      </div>
      <p>昨日 <sup>12</sup>&frasl;<sub>18</sub> に開催された「<a href="https://gcpug-tokyo.connpass.com/event/152607/">GCPUG Tokyo December 2019</a>」で「<a href="https://speakerdeck.com/mazgi/fast-development-for-ml-web-service-on-gke-and-gcp">ML アプリケーション短期開発 / Fast development for ML Web Service on GKE &amp; GCP</a>」と題してお話しさせていただきました。</p>

<script async class="speakerdeck-embed" data-id="3330c952865c46068644f1bc24042b2d" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>

<p>内容は、つい先日の日曜日に小学生のお子さんを招いて「AI 入門」講座を開催したのですが、この日の体験学習のための開発した機械学習(ML)Web アプリケーションのご紹介です。<br />
ML Web アプリケーションを短期間でどのように開発して、なぜ本番環境として GKE と GCP を選択したかお話しさせていただきました。</p>

<p>懇親会や Twitter などでいただいたご質問とコメントを元に本記事でいくつか補足を試みます。</p>

<p>「AI 入門」講座自体は今後のことは何も決まっていませんが、今回取材もしていただきましたので、もし次回が開催できた際にはぜひ多くのお子さんが参加していただけるとうれしいです。</p>

<p><a href="https://www.nikkei.com/article/DGXMZO53399380W9A211C1XXA000/">DeNA、社員が小学生向け「未来のエンジニア」講座　:日本経済新聞</a></p>

<h2 id="why-kubernetes-why-not-gae-or-others">Why Kubernetes? Why not GAE or others?</h2>

<p>「Google App Engine などの Web アプリケーション開発プラットフォームの方が簡単だったのではないか?」というご質問は何度かいただきましたし、私も今回のプロジェクトに関わってから何度か自問した問いでもあります。</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">GAEとかのほうが、とっつきやすそうだけど、<br>Docker使っているから、k8sなんですね。<br> <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; やまっぴ (@Yamappy4) <a href="https://twitter.com/Yamappy4/status/1207249477943189505?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>これは大変興味深く私としても自分の日々の技術選定を含めて整理したいトピックです。<br />
文書化を試みたら長くエモくなったので<a href="/posts/2019.12/why-choose-k8s-for-the-project/">別の記事</a>で書きます！</p>

<h2 id="other-reactions">Other reactions</h2>

<p><strong>Frontend と BFF の接続について</strong></p>

<p>質疑応答の中で<a href="https://speakerdeck.com/mazgi/fast-development-for-ml-web-service-on-gke-and-gcp?slide=17">p.17</a>の構成図に関して「なぜ BFF はインターネットからアクセスできる必要があるのか?」とご質問いただき、回答させていただきました。<br />
引用させていただいた Tweet はその質疑応答への reaction です。</p>

<p><blockquote class="twitter-tweet"><p lang="ja" dir="ltr">SSRしないケースでもAPIたたけないとまずいからBFFはPublicにしている <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; かるぱねるら (@karupanerura) <a href="https://twitter.com/karupanerura/status/1207251089327706112?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">フロントエンドが BFF をクラスタ内のルートで呼ばないで BFF にパブリックになっているのはなぜ？という質問。 SSR の時以外はブラウザクライアントから BFF を叩く必要があるためという回答かな。 <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; _ (@apstndb) <a href="https://twitter.com/apstndb/status/1207251295737794561?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</p>

<p>時間オーバーしてしまい回答が言葉足らずになってしまったのでこの記事で再掲と補足します。<br />
そもそも&rdquo;BFF(Backends For Frontend)&ldquo;という語が意味が広いと感じており、今回の BFF も「便宜上 BFF と呼んでいる Web API サーバーおよびサービス」です。</p>

<p>今回の構成では Tweet に書いてくださってる通り、Frontend では Next.js に隠蔽されたサーバーが立っています。<br />
Next.js の機能で SSR もやってますが、今回のプロジェクトに関していえば SSR は特に必須ではなくメインは単に HTML, CSS, JavaScript の配信です。<br />
この Frontend のサーバーは、強いて言えば「ちゃんと Not Found で 404 を返すために」立てています。</p>

<p>そのため BFF の接続元はあくまでブラウザの JavaScript になります。<br />
したがって BFF へのインターネットからのアクセスは必要です。</p>

<p>参加されてる方々それぞれが思い浮かべる&rdquo;Frontend&rdquo;や&rdquo;BFF&rdquo;が指すものが異なっていた可能性があり、今回のご質問を受けてうまく説明できる言葉がないかなと思いました。</p>

<p><strong>技術選定や導入について</strong></p>

<p>新し目の技術を導入してることに関して懇親会含めて何名かの方から声をかけていただきました。</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">TypeScript はもうデフォルトで選択できる感じだけど、 GraphQL を少ない工数の短期プロジェクトで選べるのはいいなーという気持ちで見ていた<a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; _ (@apstndb) <a href="https://twitter.com/apstndb/status/1207250220389564416?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>新しい技術であっても適していれば導入しやすい環境だと思います、おそらく。<br />
慣れてしまったのですが、ロジカルではない理由で技術導入が進まないケースなどを見聞きすると恵まれていることを思い出します。</p>

<p>会社全体としてもロジカルかつ新しくても適した技術を導入しやすい傾向ですが、所属部署はその社内でも特に技術ドリブンで進めやすい環境だと感じます。<br />
どこかで書いた気がするのですが部のトップ（つまり部長）まで、技術的な事柄を一切マスクや言い換えなしで相談できるのは大変ありがたいです。<br />
議論も多くは Slack や時々メールや GitHub などで行われるのでエンジニアとしてはコンテキストスイッチがとても少ないです。</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">DockerForMacが遅くなるほど巨大化したのでLinux機を導入した。<br>すばらしい。<br> <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; 0Δ@旦那ｧ! (@0Delta) <a href="https://twitter.com/0Delta/status/1207249891338018816?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>今回であれば Linux 開発機の導入を GitHub に貼ったベンチマークと必要費用だけで即決していただけました。<br />
（ちなみに決議は Slack のプロジェクトの channel 上でした）</p>

<p>その分もちろん現場に責任があり、Linux 開発機を導入のためには Docker for Mac が確かに遅く、Linux 開発機でどのようなスペックであれば現実的なパフォーマンスとなるかは計測しますし、GraphQL 導入はプロジェクトの想定トラフィックが極めて少なく性能問題に直面しない確信があってこそです。</p>

<p>また本件に限らずハイスペックな Mac や Linux 開発機、CV 系の研究開発エンジニアの方が使ってる GPU ワークステーションなどは情シス部門の方の手厚いサポートあってこそで本当に日々感謝しています。<br />
（今回も申請が受理される前に PC が準備されていました）</p>

<p><strong>GitHub GraphQL Explorer</strong></p>

<p>GraphQL、ブラウザだけあれば GitHub で気軽に試せるのでぜひ触ってみてください！<br />
私たちも最初に試して「GraphQL ってこんな感じ」が共有できました。<br />
そして次私がハマるまでに知見を世に溢れさせてほしいです！</p>

<p><a href="https://developer.github.com/v4/guides/using-the-explorer/">Using the Explorer | GitHub Developer Guide</a></p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">めも<br>GraphQL、Githubで試せるらしい。<br> <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; やまっぴ (@Yamappy4) <a href="https://twitter.com/Yamappy4/status/1207250152773173248?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p><strong>GPU 付き GCE インスタンスは急に落ちる</strong></p>

<p>GCP では我々利用者が気付かないうちにメンテナンスが実行され、GCE インスタンスは通常であればライブマイグレーションつまり OS が起動したまま別のハードウェアに移動されます（すごい！）。<br />
しかし GPU を繋いでいるとライブマイグレーションされずに強制終了されます。<br />
ドキュメントに明記されてますしハードウェアを思い浮かべると「それはそうですよね」とは思いますが困ってます。</p>

<blockquote>
<p>&ldquo;GPU instances cannot live migrate and must terminate for host maintenance events.&rdquo;</p>
</blockquote>

<p><a href="https://cloud.google.com/compute/docs/gpus/#introduction">GPUs on Compute Engine  |  Compute Engine Documentation  |  Google Cloud</a></p>

<p>この記述、長らく日本語版ドキュメントには存在しなかったのですが今確認したら載ってました。<br />
「毎月 1 回」なんてことはないです、2 日続けてインスタンス落とされた人知ってます。</p>

<figure>
    <img src="0010.png" width="800"/> 
</figure>


<p>さすが GCPUG、皆さんよくご存知ですね 😇<br />
この話題で酒が飲めそうです 🍶</p>

<p><blockquote class="twitter-tweet"><p lang="ja" dir="ltr">GPUを積んだGCEって1日でも落ちることがあるので実は怖い <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; shu1@Spinnaker入門/AWSコスト本販売中 (@ohsawa0515) <a href="https://twitter.com/ohsawa0515/status/1207249624286687232?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">GCEのGPUはメンテナンスによるTerminateが不測<br> <a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; 0Δ@旦那ｧ! (@0Delta) <a href="https://twitter.com/0Delta/status/1207249611921870848?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">GCE の GPU はメンテナンスによる terminate が不測ってのはライブマイグレーションできない って話ですね<a href="https://t.co/e8Zw9xr710">https://t.co/e8Zw9xr710</a><a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; _ (@apstndb) <a href="https://twitter.com/apstndb/status/1207249704066486272?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</p>

<h2 id="that-s-it">That&rsquo;s it</h2>

<p>資料作ってみたら案外 GCP の話題少なめで、GCP 関連のトピックを追加しようとしたら GCP 以外のトピックがさらに増えて「GCPUG なのに大丈夫かな?」と思ったのですが、さすが皆さん技術領域が広くご質問もいただけて嬉しかったです。<br />
今回くらいの規模と複雑さで GCP 使うと Terraform でぽぽいと apply してインフラレイヤーは構築できてしまうので特筆できることが少ないのですよね（とても良いこと）。</p>

<p>当日はいつも知見 Tweet にお世話になってる<a href="https://twitter.com/apstndb">@apstndb</a>さんに初対面できて光栄でした。<br />
あと <code>kubectl</code> のちゃんとした読み方教えていただきました！<br />
<code>cube control</code> なんですね、なるほど。</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ついキューブシーティーエルと言ったけどキューブコントロール派でした<br>&gt; The canonical pronunciation of kubectl is &quot;cube control&quot;.<a href="https://t.co/TFJiXEHbdK">https://t.co/TFJiXEHbdK</a><a href="https://twitter.com/hashtag/gcpug?src=hash&amp;ref_src=twsrc%5Etfw">#gcpug</a></p>&mdash; _ (@apstndb) <a href="https://twitter.com/apstndb/status/1207249239165689856?ref_src=twsrc%5Etfw">December 18, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>ご参加いただいた皆さまありがとうございました！</p>
    </article>
  </div>
  <div class="col-lg-3">
    <div class="sidebar">
  
  <h4><a href="/about/">About</a></h4>
  <p><strong>Hidenori MATSUKI</strong></p>

<p>🍣 🍶</p>

<p>another website: <a href="https://mazgi.com/">mazgi.com</a></p>
  
  <hr />
  <h4>TableOfContents</h4>
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#why-kubernetes-why-not-gae-or-others">Why Kubernetes? Why not GAE or others?</a></li>
<li><a href="#other-reactions">Other reactions</a></li>
<li><a href="#that-s-it">That&rsquo;s it</a></li>
</ul></li>
</ul>
</nav>
  <hr />
  <h4><a href="/categories/">Categories</a></h4>
  
  <div>
    <ul>
      
      <li>
        <a href="/categories/event/">event</a>
      </li>
      
    </ul>
  </div>
  
  <hr />
  <h4><a href="/tags/">Tags</a></h4>
  
  <div>
    
    <a class="badge badge-pill badge-secondary" href="/tags/kubernetes/">kubernetes</a>
    
    <a class="badge badge-pill badge-secondary" href="/tags/docker/">docker</a>
    
    <a class="badge badge-pill badge-secondary" href="/tags/docker-compose/">docker-compose</a>
    
    <a class="badge badge-pill badge-secondary" href="/tags/ml-engineering/">ml-engineering</a>
    
    <a class="badge badge-pill badge-secondary" href="/tags/web-frontend/">web-frontend</a>
    
  </div>
  
</div>

  </div>
</div>
      <div class="row">
        <footer class="col-lg-12">
          <hr/>
          <span>&copy; mazgi.log</span>
          <span>&nbsp;&middot;&nbsp;</span>
          <i class="fas fa-bolt"></i>
          <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
        </footer>
      </div>
    </div>
    </main>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68170979-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68170979-2');
    </script>
    
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
  </body>
</html>

