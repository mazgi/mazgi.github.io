<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="/common/favicon.ico">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/common/site.css">
    
    
    <title>mazgi.log :: SSE-KMSで暗号化したS3バケットをs3fsでmountする</title>
    <meta property="og:title"       content="mazgi.log :: SSE-KMSで暗号化したS3バケットをs3fsでmountする" />
    <meta property="og:type"        content="article" />
    
    <meta property="og:url"         content="https://mazgi.github.io/posts/2018.03/s3fs-for-s3-with-sse-kms/" />
    
      
      <meta property="og:description" content="mazgi&#39;s tech blog" />
      
    
    
    
    
    
    
    
    
    
    
    
    <meta name="twitter:card"       content="summary" />
    
    
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      
      <span class="navbar-text mr-1">I am on</span>
      
      <ul class="navbar-nav">
        
        <li class="nav-item">
          <a class="nav-link" target="github_mazgi" rel="noopener" href="https://github.com/mazgi">GitHub<i class="ml-1 fab fa-github"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="twitter_mazgi" rel="noopener" href="https://twitter.com/@mazgi">Twitter<i class="ml-1 fab fa-twitter"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="instagram_mazgi" rel="noopener" href="https://www.instagram.com/mazgi">Instagram<i class="ml-1 fab fa-instagram"></i></a>
        </li>
        
        
      </ul>
    </header>
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://mazgi.github.io/">mazgi.log</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_nav" aria-controls="navbar_nav" aria-expand="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_nav">
        
        <ul class="navbar-nav mr-auto">
          
          
          
          <li class="nav-item">
            <span class="nav-link disabled">Created At: 2018.03.01</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">Updated At: 2021.01.14</span>
          </li>
          
        </ul>
        
        <div class="navbar-nav ml-auto">
          <span class="navbar-text mr-1">share this page via</span>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/share?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2018.03%2fs3fs-for-s3-with-sse-kms%2f&text=SSE-KMS%e3%81%a7%e6%9a%97%e5%8f%b7%e5%8c%96%e3%81%97%e3%81%9fS3%e3%83%90%e3%82%b1%e3%83%83%e3%83%88%e3%82%92s3fs%e3%81%a7mount%e3%81%99%e3%82%8b" target="_blank" rel="noopener"><i class="fab fa-twitter"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmazgi.github.io%2fposts%2f2018.03%2fs3fs-for-s3-with-sse-kms%2f" target="_blank" rel="noopener"><i class="fab fa-facebook"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2018.03%2fs3fs-for-s3-with-sse-kms%2f&title=SSE-KMS%e3%81%a7%e6%9a%97%e5%8f%b7%e5%8c%96%e3%81%97%e3%81%9fS3%e3%83%90%e3%82%b1%e3%83%83%e3%83%88%e3%82%92s3fs%e3%81%a7mount%e3%81%99%e3%82%8b" target="_blank" rel="noopener"><i class="fab fa-linkedin"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://plusone.google.com/_/+1/confirm?url=https%3a%2f%2fmazgi.github.io%2fposts%2f2018.03%2fs3fs-for-s3-with-sse-kms%2f" target="_blank" rel="noopener"><i class="fab fa-google-plus"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://b.hatena.ne.jp/entry/https://mazgi.github.io/posts/2018.03/s3fs-for-s3-with-sse-kms/" target="_blank" rel="noopener">b!</a>
            </li>
          </ul>
        </div>
        
      </div>
    </nav>
    <main role="main" class="container-fluid col-lg-10 offset-lg-1">

<div class="row">
  <div class="col-lg-9">
    <article>
      <div class="row">
        <h1>SSE-KMSで暗号化したS3バケットをs3fsでmountする</h1>
      </div>
      <p>タイトルの通り「AWS Key Management Service (AWS KMS) 」を使って暗号化したAmazon S3バケットをs3fsでUbuntu 16上でmountした。<br>
KMSについては以下のドキュメントが詳しいが要は暗号化の際に煩雑な鍵の管理をAWSにお願いできる仕組み。</p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/UsingKMSEncryption.html">AWS KMS で管理されたキーによるサーバー側の暗号化 (SSE-KMS) を使用したデータの保護 - Amazon Simple Storage Service</a></p>
<h1 id="s3バケットの準備">S3バケットの準備</h1>
<p>S3バケットを作り、画像のように <code>Default encryption</code> を <code>AWS-KMS</code> に設定する。<br>
なおこのS3バケットは記事公開時点で削除済み。</p>
<figure>
    <img src="/posts/2018.03/s3fs-for-s3-with-sse-kms/0001.png"/> 
</figure>

<h1 id="s3fsの設定">s3fsの設定</h1>
<h2 id="install">Install</h2>
<p>GitHubからアーカイブをダウンロードして</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ./autogen.sh
$ ./configure
$ make
$ sudo make install</code></pre></div>
<p>する。</p>
<p><a href="https://github.com/s3fs-fuse/s3fs-fuse/releases/tag/v1.83">Release Release verson 1.83 · s3fs-fuse/s3fs-fuse</a></p>
<h2 id="mount">mount</h2>
<p>以下のようにAWSのcredentialを <code>.secret</code> というファイルに <code>ACCESS_KEY:SECRET_KEY</code> というフォーマットで書く。<br>
またKMSの鍵IDを環境変数に設定した。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat .secret
****ACCESS_KEY****:****SECRET_KEY****
$ <span style="color:#007020">export</span> <span style="color:#bb60d5">AWSSSEKMSID</span><span style="color:#666">=</span><span style="color:#4070a0">&#39;********&#39;</span></code></pre></div>
<p>そしてmountする。<br>
<code>endpoint</code>, <code>uid</code>, <code>gid</code> , <code>umask</code> あたりをきちんと設定しないと読み書きできない、ハマった。<br>
なお鍵IDは環境変数使わなくても <code>use_sse=kmsid:&quot;${AWSSSEKMSID}&quot;</code> でいける模様。</p>
<p>また <code>-d</code> はdebug、 <code>-f</code> はフォアグラウンド実行。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ s3fs mazgi-s3-sse-kms-test-01-bucket-01 bucket -o <span style="color:#bb60d5">passwd_file</span><span style="color:#666">=</span>.secret,use_sse<span style="color:#666">=</span>kmsid,endpoint<span style="color:#666">=</span>ap-northeast-1,allow_other,uid<span style="color:#666">=</span>1234,gid<span style="color:#666">=</span>1234,umask<span style="color:#666">=</span><span style="color:#40a070">227</span> -d -f
<span style="color:#666">[</span>CRT<span style="color:#666">]</span> s3fs.cpp:set_s3fs_log_level<span style="color:#666">(</span>271<span style="color:#666">)</span>: change debug level from <span style="color:#666">[</span>CRT<span style="color:#666">]</span> to <span style="color:#666">[</span>INF<span style="color:#666">]</span> 
<span style="color:#666">[</span>INF<span style="color:#666">]</span>     s3fs.cpp:set_mountpoint_attribute<span style="color:#666">(</span>4206<span style="color:#666">)</span>: PROC<span style="color:#666">(</span><span style="color:#bb60d5">uid</span><span style="color:#666">=</span>4600, <span style="color:#bb60d5">gid</span><span style="color:#666">=</span>4600<span style="color:#666">)</span> - MountPoint<span style="color:#666">(</span><span style="color:#bb60d5">uid</span><span style="color:#666">=</span>4600, <span style="color:#bb60d5">gid</span><span style="color:#666">=</span>4600, <span style="color:#bb60d5">mode</span><span style="color:#666">=</span>40775<span style="color:#666">)</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_init<span style="color:#666">(</span>3371<span style="color:#666">)</span>: init v1.83<span style="color:#666">(</span>commit:unknown<span style="color:#666">)</span> with OpenSSL
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_check_service<span style="color:#666">(</span>3747<span style="color:#666">)</span>: check services.
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:CheckBucket<span style="color:#666">(</span>3068<span style="color:#666">)</span>: check a bucket.
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span></code></pre></div>
<h2 id="ファイル操作">ファイル操作</h2>
<p><code>ls</code> してみる。</p>
<p>なおS3バケットに入っているJPEG画像はこれ。かわいい。<br>
「<a href="https://www.pakutaso.com/">ぱくたそ</a>」からお借りした。</p>
<figure>
    <img src="/posts/2018.03/s3fs-for-s3-with-sse-kms/0002.jpeg"/> 
</figure>

<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l bucket
total <span style="color:#40a070">179</span>
-r-xr-x--- <span style="color:#40a070">1</span> user group <span style="color:#40a070">96870</span> Feb  <span style="color:#40a070">1</span> 07:10 cat.jpg*
-r-xr-x--- <span style="color:#40a070">1</span> user group <span style="color:#40a070">84999</span> Feb  <span style="color:#40a070">1</span> 07:13 cat_plain.jpg*</code></pre></div>
<p>その時のコンソールログ。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_opendir<span style="color:#666">(</span>2281<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">][</span><span style="color:#bb60d5">flags</span><span style="color:#666">=</span>100352<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_readdir<span style="color:#666">(</span>2432<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>   s3fs.cpp:list_bucket<span style="color:#666">(</span>2477<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:ListBucketRequest<span style="color:#666">(</span>3103<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>1000&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>1000&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/<span style="color:#666">]</span> <span style="color:#666">[</span><span style="color:#bb60d5">delimiter</span><span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>1000&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>INF<span style="color:#666">]</span>   s3fs.cpp:readdir_multi_head<span style="color:#666">(</span>2346<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">][</span><span style="color:#bb60d5">list</span><span style="color:#666">=</span>0<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=</span>cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">save</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/cat.jpg<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat_plain.jpg<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=</span>cat_plain.jpg<span style="color:#666">][</span><span style="color:#bb60d5">save</span><span style="color:#666">=</span>/cat_plain.jpg<span style="color:#666">][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat_plain.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat_plain.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/cat_plain.jpg<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:Request<span style="color:#666">(</span>3999<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">count</span><span style="color:#666">=</span>2<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat_plain.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat_plain.jpg<span style="color:#666">]</span></code></pre></div>
<p>アップロード前のチェックサムがこれ。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ shasum -a <span style="color:#40a070">1</span> cat.jpg
fb9f3c47ad3d91ced2e62c82f0ae753330351b32  cat.jpg</code></pre></div>
<p>mountしたS3バケットから読み取りテスト兼ねてチェックサムを取得してみる。<br>
一致しているので正しく読み取れていることがわかる。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sha1sum bucket/cat.jpg
fb9f3c47ad3d91ced2e62c82f0ae753330351b32  bucket/cat.jpg</code></pre></div>
<p>ファイル読み取り時のコンソールログ。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_open<span style="color:#666">(</span>2063<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">flags</span><span style="color:#666">=</span>32768<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:DelStat<span style="color:#666">(</span>565<span style="color:#666">)</span>: delete stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/cat.jpg<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:SetMtime<span style="color:#666">(</span>1019<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">][</span><span style="color:#bb60d5">time</span><span style="color:#666">=</span>1517436613<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:GetObjectRequest<span style="color:#666">(</span>3043<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">start</span><span style="color:#666">=</span>0<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>96870<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreGetObjectRequest<span style="color:#666">(</span>2983<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">start</span><span style="color:#666">=</span>0<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>96870<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/cat.jpg
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/cat.jpg<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:GetObjectRequest<span style="color:#666">(</span>3058<span style="color:#666">)</span>: downloading... <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">206</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_flush<span style="color:#666">(</span>2185<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:RowFlush<span style="color:#666">(</span>1434<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_release<span style="color:#666">(</span>2238<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:GetFdEntity<span style="color:#666">(</span>1995<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/cat.jpg<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span></code></pre></div>
<p>今度はS3バケットにファイルを書き込んでみる。<br>
適当にファイルを作りチェックサムを取得。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ head -1 /dev/urandom|od -x &gt; rand.txt
$ sha1sum rand.txt
bb02ee0d5fc5b459ca1978fcc0e53649d144554c  rand.txt</code></pre></div>
<p>マウントポイントにコピーする。<br>
コピー後のチェックサムが一致しているので正しくコピーできたことがわかる。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cp rand.txt bucket/
$ sha1sum bucket/rand.txt
bb02ee0d5fc5b459ca1978fcc0e53649d144554c  bucket/rand.txt</code></pre></div>
<p>書き込み時のコンソールログ。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>   s3fs.cpp:list_bucket<span style="color:#666">(</span>2477<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:ListBucketRequest<span style="color:#666">(</span>3103<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/<span style="color:#666">]</span> <span style="color:#666">[</span><span style="color:#bb60d5">delimiter</span><span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>   s3fs.cpp:list_bucket<span style="color:#666">(</span>2477<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:ListBucketRequest<span style="color:#666">(</span>3103<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/<span style="color:#666">]</span> <span style="color:#666">[</span><span style="color:#bb60d5">delimiter</span><span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_create<span style="color:#666">(</span>999<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">mode</span><span style="color:#666">=</span>100664<span style="color:#666">][</span><span style="color:#bb60d5">flags</span><span style="color:#666">=</span>32961<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt/<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt_%24folder%24
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt_<span style="color:#bb60d5">$folder</span>$<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2073<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">404</span> was returned, returning ENOENT
<span style="color:#666">[</span>INF<span style="color:#666">]</span>   s3fs.cpp:list_bucket<span style="color:#666">(</span>2477<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:ListBucketRequest<span style="color:#666">(</span>3103<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com?delimiter<span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/<span style="color:#666">]</span> <span style="color:#666">[</span><span style="color:#bb60d5">delimiter</span><span style="color:#666">=</span>/&amp;max-keys<span style="color:#666">=</span>2&amp;<span style="color:#bb60d5">prefix</span><span style="color:#666">=</span>rand.txt/<span style="color:#666">]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>WAN<span style="color:#666">]</span> s3fs.cpp:append_objects_from_xml_ex<span style="color:#666">(</span>2575<span style="color:#666">)</span>: contents_xp-&gt;nodesetval is empty.
<span style="color:#666">[</span>INF<span style="color:#666">]</span>     s3fs.cpp:create_file_object<span style="color:#666">(</span>960<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">mode</span><span style="color:#666">=</span>100664<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PutRequest<span style="color:#666">(</span>2872<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PutRequest<span style="color:#666">(</span>2889<span style="color:#666">)</span>: create zero byte file object.
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>PUT<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PutRequest<span style="color:#666">(</span>2969<span style="color:#666">)</span>: uploading... <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>-1<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>0<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:DelStat<span style="color:#666">(</span>565<span style="color:#666">)</span>: delete stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_flush<span style="color:#666">(</span>2185<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:RowFlush<span style="color:#666">(</span>1434<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PutRequest<span style="color:#666">(</span>2872<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>PUT<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[</span>2a5b392dff6867a115948ff04fbec762a6f007cffebf40544c62308ec9eab099<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PutRequest<span style="color:#666">(</span>2969<span style="color:#666">)</span>: uploading... <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>996<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_release<span style="color:#666">(</span>2238<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:DelStat<span style="color:#666">(</span>565<span style="color:#666">)</span>: delete stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:GetFdEntity<span style="color:#666">(</span>1995<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span></code></pre></div>
<p>こちらはチェックサム取得時のコンソールログ。</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_open<span style="color:#666">(</span>2063<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">flags</span><span style="color:#666">=</span>32768<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:DelStat<span style="color:#666">(</span>565<span style="color:#666">)</span>: delete stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:HeadRequest<span style="color:#666">(</span>2708<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreHeadRequest<span style="color:#666">(</span>2657<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">bpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">save</span><span style="color:#666">=][</span><span style="color:#bb60d5">sseckeypos</span><span style="color:#666">=</span>-1<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>HEAD<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">200</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       cache.cpp:AddStat<span style="color:#666">(</span>356<span style="color:#666">)</span>: add stat cache entry<span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:SetMtime<span style="color:#666">(</span>1019<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">][</span><span style="color:#bb60d5">time</span><span style="color:#666">=</span>1517862525<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:GetObjectRequest<span style="color:#666">(</span>3043<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">start</span><span style="color:#666">=</span>0<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>996<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:PreGetObjectRequest<span style="color:#666">(</span>2983<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">start</span><span style="color:#666">=</span>0<span style="color:#666">][</span><span style="color:#bb60d5">size</span><span style="color:#666">=</span>996<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4253<span style="color:#666">)</span>: URL is https://s3.amazonaws.com/mazgi-s3-sse-kms-test-01-bucket-01/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:prepare_url<span style="color:#666">(</span>4285<span style="color:#666">)</span>: URL changed is https://mazgi-s3-sse-kms-test-01-bucket-01.s3.amazonaws.com/rand.txt
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:insertV4Headers<span style="color:#666">(</span>2400<span style="color:#666">)</span>: computing signature <span style="color:#666">[</span>GET<span style="color:#666">]</span> <span style="color:#666">[</span>/rand.txt<span style="color:#666">]</span> <span style="color:#666">[]</span> <span style="color:#666">[]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:url_to_host<span style="color:#666">(</span>101<span style="color:#666">)</span>: url is https://s3.amazonaws.com
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:GetObjectRequest<span style="color:#666">(</span>3058<span style="color:#666">)</span>: downloading... <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       curl.cpp:RequestPerform<span style="color:#666">(</span>2051<span style="color:#666">)</span>: HTTP response code <span style="color:#40a070">206</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_getattr<span style="color:#666">(</span>841<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_flush<span style="color:#666">(</span>2185<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:RowFlush<span style="color:#666">(</span>1434<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">tpath</span><span style="color:#666">=][</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span> s3fs.cpp:s3fs_release<span style="color:#666">(</span>2238<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span>
<span style="color:#666">[</span>INF<span style="color:#666">]</span>       fdcache.cpp:GetFdEntity<span style="color:#666">(</span>1995<span style="color:#666">)</span>: <span style="color:#666">[</span><span style="color:#bb60d5">path</span><span style="color:#666">=</span>/rand.txt<span style="color:#666">][</span><span style="color:#bb60d5">fd</span><span style="color:#666">=</span>7<span style="color:#666">]</span></code></pre></div>
<p>以上、ちょっとハマったができてみるとあっさり暗号化したS3バケットが扱えた。</p>
<p>で、「これをprovisioningするの時間がないなー」とか思ってたら斜め後ろのベテランエンジニアがサクッとitamaeのrecipeにしてくれた。感謝。</p>

    </article>
  </div>
  <div class="col-lg-3">
    <div class="sidebar">
  
  <h4><a href="/about/">About</a></h4>
  <p><strong>Hidenori MATSUKI</strong></p>
<p>🍣 🍶</p>
<p>another website: <a href="https://mazgi.com/">mazgi.com</a></p>
  
  <hr />
  <h4>TableOfContents</h4>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#install">Install</a></li>
    <li><a href="#mount">mount</a></li>
    <li><a href="#ファイル操作">ファイル操作</a></li>
  </ul>
</nav>
  <hr />
  <h4><a href="/categories/">Categories</a></h4>
  
  <div>
    <ul>
      
      <li>
        <a href="/categories/infrastructure-as-code/">infrastructure as code</a>
      </li>
      
    </ul>
  </div>
  
  <hr />
  <h4><a href="/tags/">Tags</a></h4>
  
  <div>
    
    <a class="badge badge-pill badge-secondary" href="/tags/aws/">aws</a>
    
    <a class="badge badge-pill badge-secondary" href="/tags/amazon-s3/">amazon s3</a>
    
  </div>
  
</div>

  </div>
</div>
      <div class="row">
        <footer class="col-lg-12">
          <hr/>
          <span>&copy; mazgi.log</span>
          <span>&nbsp;&middot;&nbsp;</span>
          <i class="fas fa-bolt"></i>
          <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a></span>
          
          <span>&nbsp;&middot;&nbsp;</span>
          <span>This website <a href="https://policies.google.com/technologies/partner-sites" target="_blank" rel="noopener">uses Google Analytics</a>.</span>
          
        </footer>
      </div>
    </div>
    </main>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68170979-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68170979-2');
    </script>
    
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
  </body>
</html>

