<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="/common/favicon.ico">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/common/site.css">
    
    
    <title>mazgi.log :: #gc_k8sday &#34;Google Cloud Kubernetes Day&#34;に行ってきました</title>
    <meta property="og:title"       content="mazgi.log :: #gc_k8sday &#34;Google Cloud Kubernetes Day&#34;に行ってきました" />
    <meta property="og:type"        content="article" />
    
    <meta property="og:url"         content="https://mazgi.github.io/ja/posts/2019/03/went-to-google-cloud-kubernetes-day/" />
    
      
      <meta property="og:description" content="mazgi&#39;s tech blog" />
      
    
    
    
    
    
    
    
    
    
    
    <meta property="og:image"       content="https://mazgi.github.io/posts/2019/03/went-to-google-cloud-kubernetes-day/og.jpeg" />
    <meta property="twitter:image"  content="https://mazgi.github.io/posts/2019/03/went-to-google-cloud-kubernetes-day/og.jpeg" />
    <meta property="twitter:image:src"  content="https://mazgi.github.io/posts/2019/03/went-to-google-cloud-kubernetes-day/og.jpeg" />
    
    
    <meta name="twitter:card"       content="summary" />
    
    
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      
      <span class="navbar-text mr-1">I am on</span>
      
      <ul class="navbar-nav">
        
        <li class="nav-item">
          <a class="nav-link" target="github_mazgi" rel="noopener" href="https://github.com/mazgi">GitHub<i class="ml-1 fab fa-github"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="twitter_mazgi" rel="noopener" href="https://twitter.com/@mazgi">Twitter<i class="ml-1 fab fa-twitter"></i></a>
        </li>
        
        
        <li class="nav-item">
          <a class="nav-link" target="instagram_mazgi" rel="noopener" href="https://www.instagram.com/mazgi">Instagram<i class="ml-1 fab fa-instagram"></i></a>
        </li>
        
        
      </ul>
    </header>
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://mazgi.github.io/">mazgi.log</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_nav" aria-controls="navbar_nav" aria-expand="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_nav">
        
        <ul class="navbar-nav mr-auto">
          
          
          
          <li class="nav-item">
            <span class="nav-link disabled">Created At: 2019.03.26</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">Updated At: 2023.04.17</span>
          </li>
          
        </ul>
        
        <div class="navbar-nav ml-auto">
          <span class="navbar-text mr-1">share this page via</span>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/share?url=https%3a%2f%2fmazgi.github.io%2fja%2fposts%2f2019%2f03%2fwent-to-google-cloud-kubernetes-day%2f&text=%23gc_k8sday%20%22Google%20Cloud%20Kubernetes%20Day%22%e3%81%ab%e8%a1%8c%e3%81%a3%e3%81%a6%e3%81%8d%e3%81%be%e3%81%97%e3%81%9f" target="_blank" rel="noopener"><i class="fab fa-twitter"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fmazgi.github.io%2fja%2fposts%2f2019%2f03%2fwent-to-google-cloud-kubernetes-day%2f" target="_blank" rel="noopener"><i class="fab fa-facebook"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fmazgi.github.io%2fja%2fposts%2f2019%2f03%2fwent-to-google-cloud-kubernetes-day%2f&title=%23gc_k8sday%20%22Google%20Cloud%20Kubernetes%20Day%22%e3%81%ab%e8%a1%8c%e3%81%a3%e3%81%a6%e3%81%8d%e3%81%be%e3%81%97%e3%81%9f" target="_blank" rel="noopener"><i class="fab fa-linkedin"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://plusone.google.com/_/+1/confirm?url=https%3a%2f%2fmazgi.github.io%2fja%2fposts%2f2019%2f03%2fwent-to-google-cloud-kubernetes-day%2f" target="_blank" rel="noopener"><i class="fab fa-google-plus"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://b.hatena.ne.jp/entry/https://mazgi.github.io/ja/posts/2019/03/went-to-google-cloud-kubernetes-day/" target="_blank" rel="noopener">b!</a>
            </li>
          </ul>
        </div>
        
      </div>
    </nav>
    <main role="main" class="container-fluid col-lg-10 offset-lg-1">

<div class="row">
  <div class="col-lg-9">
    <article>
      <div class="row">
        <h1>#gc_k8sday &#34;Google Cloud Kubernetes Day&#34;に行ってきました</h1>
      </div>
      <p>3/26 に開催された「Google Cloud Kubernetes Day」に当選したので参加してきました。<br>
最前列でひたすらメモったので放出しておきます。</p>
<h1 id="program">Program</h1>
<p>こんなプログラムでした。</p>
<ul>
<li>開催挨拶</li>
<li>Keynote: 「Kubernetes/Container による開発」の導入難易度とメリット</li>
<li>Session1: コンテナ開発プラットフォームに GKE を選択すべき 7 つの理由</li>
<li>Session2: GKE を用いたレガシー システムからのリプレース事例</li>
<li>Session3: コンテナによる開発と運用の進化</li>
<li>Session4: FreakOut の広告プロダクトでの GKE 活用事例と GKE 新機能の導入について</li>
</ul>
<p>詳しくは<a href="https://cloudplatformonline.com/2019-google-cloud-kubernetes-day-0326.html">イベントページ</a>をご参照ください。</p>
<h1 id="memo">Memo</h1>
<p>以下メモです。<br>
あまり整理できていません。<br>
あとところどころメモが追いついていない。</p>
<p>資料は参加者のみ後日送付だったので載せられません。</p>
<h2 id="keynote">Keynote</h2>
<p><strong>「k8s/container による開発」の導入難易度とメリット</strong></p>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">本日は Google Cloud Kubernetes Day で『「Kubernetes/Container による開発」の導入難易度とメリット 』というテーマで基調講演を担当させて頂きます。恐縮です。<a href="https://t.co/26U0mPDgo5">https://t.co/26U0mPDgo5</a><br> <a href="https://twitter.com/hashtag/gc_k8sday?src=hash&amp;ref_src=twsrc%5Etfw">#gc_k8sday</a> <a href="https://twitter.com/hashtag/Kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#Kubernetes</a> <a href="https://t.co/H4emx4If0P">pic.twitter.com/H4emx4If0P</a></p>&mdash; MasayaAoyama（青山真也） ⎈ @CyberAgent (@amsy810) <a href="https://twitter.com/amsy810/status/1110405538200731658?ref_src=twsrc%5Etfw">March 26, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<ul>
<li>普段
<ul>
<li>オンプレで GKE っぽい k8s 基盤を作ってる</li>
<li>K8s を使ったシステムのアーキテクトをしてる</li>
</ul>
</li>
<li>著書
<ul>
<li><a href="https://amzn.to/2KmEaas">K8s 完全ガイド</a></li>
</ul>
</li>
<li>CA と k8s の関係
<ul>
<li>2016 年頃から k8s 採用、かなり早かった</li>
<li>GKE やオンプレでの使用が多い</li>
<li>オンプレの場合は GKE インスパイアな仕組みを作ってる</li>
<li>新規事業がたくさん立ち上がるが、ほとんどのケースで k8s やコンテナを活用</li>
<li>レガシーもある、k8s/コンテナへの移行を進めてる
<ul>
<li>&ldquo;CA k8s&quot;などでググると記事がある</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="whats-k8s">What’s k8s?</h4>
<ul>
<li>コンテナをオーケストレーションするシステム</li>
<li>元は Google 社内の Borg</li>
<li>現在は CNCF が中立的にホストしてる</li>
<li>コミュニティによって改良されている</li>
</ul>
<h4 id="this-is-k8s-era">This is k8s era</h4>
<ul>
<li>時代は k8s</li>
<li>手のひらサイズの k8s クラスタ持ってますよね?
<ul>
<li>持ってない人はヨドバシとかで RPi 買ってください！</li>
</ul>
</li>
</ul>
<h5 id="オーケストレーションとは">オーケストレーションとは?</h5>
<ul>
<li>Classification of &ldquo;Provisioning&rdquo;
<ul>
<li>Bootstrapping
<ul>
<li>サーバー準備</li>
<li>OS インストール</li>
</ul>
</li>
<li>Configuration
<ul>
<li>サーバーセットアップ</li>
</ul>
</li>
<li>Orchestration</li>
</ul>
</li>
</ul>
<h5 id="baremetal-era">Baremetal Era</h5>
<ul>
<li>温かみのある手動 Provisioning
<ul>
<li>台数増えると辛い</li>
<li>自動化を始める</li>
</ul>
</li>
<li>Net boot</li>
<li>自前 Shell Scripts</li>
<li>CA でもまだ残っている</li>
<li>各社秘伝のコードになりがち</li>
</ul>
<h5 id="cloud-era">Cloud Era</h5>
<ul>
<li>Terraform, Chef/Ansible/Puppet/Salt, Fabric/Capistrano
<ul>
<li>構造化される</li>
<li>再現性高くない</li>
<li>構築に時間かかる</li>
</ul>
</li>
<li>イメージ化する
<ul>
<li>Packer, Cloud Images, OpenStack Heat, AWS Can</li>
<li>イメージ化による高い再現性</li>
<li>あまり簡単ではない</li>
<li>IaaS ロックイン</li>
</ul>
</li>
</ul>
<h5 id="cloud-native-era">Cloud Native Era</h5>
<ul>
<li>イメージ化=&gt;Docker
<ul>
<li>容易</li>
<li>軽量</li>
<li>高速な起動と停止</li>
<li>高い抽象度と IaaS 非依存</li>
<li>宣言的な API と Code</li>
<li>新しい考え方が必要</li>
</ul>
</li>
</ul>
<h4 id="what-is-cloud-native">What is Cloud Native?</h4>
<ul>
<li>定義がある
<ul>
<li>CNCF が出してる</li>
</ul>
</li>
<li>どんな定義?
<ul>
<li>疎結合なシステム</li>
<li>復元力がある</li>
<li>管理しやすい</li>
<li>可観測である</li>
<li>堅牢な自動化により、</li>
</ul>
</li>
</ul>
<h4 id="cloud---cloud-native">Cloud -&gt; Cloud Native</h4>
<ul>
<li>Cloud Native Trail Map が参考になる</li>
<li>容易なイメージ化と再現性 by Docker
<ul>
<li>アプリと実行環境のイメージ化
<ul>
<li>=&gt;再現性の高い環境</li>
</ul>
</li>
<li>アプリケーションのビルドもコンテナのビルド時に実施</li>
<li>OCI v1.0 によるポータビリティ
<ul>
<li>規格でフォーマットが決まっている</li>
</ul>
</li>
<li>ローカルでも同等の動作が保証される</li>
</ul>
</li>
<li>軽量なイメージ by Docker
<ul>
<li>VM イメージと比べて軽量</li>
<li>単一プロセスのみ稼働させるため、軽量 OS を選定しやすい
<ul>
<li>しかしサイドカーとか</li>
</ul>
</li>
</ul>
</li>
<li>高速な起動と停止
<ul>
<li>VM の起動停止より高速
<ul>
<li>VM は OS、コンテナはプロセス</li>
</ul>
</li>
<li>起動が高速だとスケールアウト早い</li>
<li>障害時の復旧が早い
<ul>
<li>Provisioning やり直す場合の時間比較</li>
</ul>
</li>
</ul>
</li>
<li>Containerization まとめ
<ul>
<li>軽量なイメージ化と再現性/軽量なイメージ/高速な起動と停止</li>
<li>そんなに難しくない</li>
</ul>
</li>
<li>オーケストレーション</li>
<li>高い抽象度と IaaS 非依存 by k8s
<ul>
<li>LB や Storage なども抽象化</li>
<li>利用者から見ると IaaS 固有の知識がほぼ不要</li>
<li>ベンダーニュートラルな実行基盤</li>
</ul>
</li>
<li>宣言的な API と Code by k8s
<ul>
<li>構成情報を yaml の manifests で宣言的に記述して API に登録</li>
<li>e.g. 複数コンテナの管理
<ul>
<li><code>replicas: N</code> を指定するだけで良い</li>
</ul>
</li>
<li>E.g. LB との連携
<ul>
<li>転送先ポート番号と対象コンテナを指定</li>
<li>ラベルという抽象的な概念で管理できる</li>
</ul>
</li>
<li>Control Loop と Reconciliation
<ul>
<li>Control Loop
<ul>
<li>現在の状態を観測</li>
<li>現在の状態と理想状態を比較</li>
<li>差分に対処する処理を実施(Reconciliation)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>洗練された自動化 by k8s
<ul>
<li>セルフヒーリング
<ul>
<li>ReplicaSet ではコンテナの Replicas を維持し続ける</li>
</ul>
</li>
<li>アプリケーションのアップグレード
<ul>
<li>Manifests のイメージバージョンを書き換えるだけ</li>
</ul>
</li>
<li>コンテナ単位のヘルスチェック</li>
<li>コンテナ起動前の初期化処理</li>
<li>コンテナ停止時の SIGNAL</li>
<li>コンテナ開始直後〜</li>
</ul>
</li>
<li>豊富なエコシステムと拡張性 by k8s
<ul>
<li>MySQL Cluster on k8s
<ul>
<li>Manifest を登録すると MySQL クラスタが作られる</li>
</ul>
</li>
<li>CI/CD on k8s</li>
<li>Serverless on k8s
<ul>
<li>K native</li>
</ul>
</li>
<li>Service Mesh on k8s
<ul>
<li>いすてぃお</li>
<li>Istio</li>
</ul>
</li>
<li>Managed Service via k8s
<ul>
<li>K8s から外の managed service を制御する</li>
<li>シークレットとかを k8s に持ってくれる?</li>
</ul>
</li>
<li>YOUR FEATURES w/ k8s
<ul>
<li>自分で書けるよ！</li>
<li>そんなに難しくない</li>
<li>Control Loop をうまく使うツールが色々提供されている</li>
</ul>
</li>
</ul>
</li>
<li>導入難易度
<ul>
<li>アプリケーションアーキテクチャ
<ul>
<li>多少細分化が必要</li>
<li>基本はマイクロサービス</li>
<li>いつでも停止できるよう SIGTERM のハンドリング必須</li>
<li>頻繁に停止する
<ul>
<li>ノードのアップグレード</li>
<li>コンテナイメージのアップデート</li>
</ul>
</li>
<li>Service Discovery 経由での通信</li>
<li>ネットワークの一部制約
<ul>
<li>Source IP が消える</li>
</ul>
</li>
</ul>
</li>
<li>セキュリティと分離性
<ul>
<li>runC では kernel が共有されている
<ul>
<li>gVisor のような分離性高いランタイム使うと回避できる</li>
</ul>
</li>
<li>ネットワークの分離性
<ul>
<li>GKE ではネットワークポリシー使うべし</li>
</ul>
</li>
</ul>
</li>
<li>K8s 学習コスト
<ul>
<li>学習コストは小さくない</li>
<li>CA 内のアンケートでは「今後やっていきたい」が 100%</li>
</ul>
</li>
<li>K8s クラスタ運用のつらみ
<ul>
<li>GKE 使うと解放されるよ！</li>
<li>GKE オンプレも今後は使えるのでは?</li>
</ul>
</li>
<li>マネージド k8s の選定基準
<ul>
<li>マネージドの範囲</li>
<li>自動化機能</li>
<li>K8s バージョンの追従</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ca-と-gke">CA と GKE</h4>
<ul>
<li>K8s 環境は GKE が多い
<ul>
<li>オンプレ=&gt;44%, GKE=&gt;44%, AWS=&gt;6%, EKS=&gt;6%</li>
</ul>
</li>
<li>GKE の自動化機能をフル活用してる
<ul>
<li>一部プロダクトはこれらの機能提供前に存在したので使ってないが</li>
</ul>
</li>
<li>アドテクのレイテンシ要件を GKE で満たせてる</li>
<li>新規開発のほとんで GKE を使用</li>
<li>ステートフルな部分は GCP の他のサービスをフル活用</li>
</ul>
<h4 id="宣伝">宣伝</h4>
<p>「『みんなの Docker/Kubernetes』という本が出ます！」</p>
<!-- raw HTML omitted -->
<h3 id="感想">(感想)</h3>
<p>「GKE でアドテクのレイテンシ要件満たせている」というのが大変興味深かったです。<br>
アドテクだと集計的なある程度時間がかかる job や、機械学習のような GPU 等のデバイスをアタッチするケースがあるはず。<br>
そういった場合の GKE/k8s 活用について機会があったら伺いたい。</p>
<h2 id="コンテナ開発プラットフォームに-gke-を選択すべき-7-つの理由">コンテナ開発プラットフォームに GKE を選択すべき 7 つの理由</h2>
<p>前のセッションで運用面詳しく触れられたので 7→5 つに絞って紹介</p>
<h3 id="理由-1-security">理由 1 Security</h3>
<ul>
<li>K8s を採用する理由
<ul>
<li>当初はアジリティでは?</li>
<li>エンタープライズで使う場合セキュリティ大事</li>
</ul>
</li>
<li>GCP のセキュリティは高く評価されている</li>
<li>今のセキュリティ
<ul>
<li>昔は「クラウドのセキュリティは心配」</li>
<li>今はセキュリティがクラウドを選ぶ理由になっている</li>
</ul>
</li>
<li>GCP のセキュリティ
<ul>
<li>色々なレイヤーで徹底的な防御がデフォルトで ON</li>
<li>ストレージレイヤでのデフォルト暗号化</li>
<li>ハードウェアでもセキュリティを重視
<ul>
<li>YouTube で Cloud On Air みてください</li>
</ul>
</li>
</ul>
</li>
<li>コンテナのセキュリティ?
<ul>
<li>Infra Security
<ul>
<li>インフラはコンテナを開発するのに安全か?</li>
<li>K8s の機能を使って ID,シークレット,ネットワークをどう守るか</li>
<li>IAM,Audit Logs,Networking などの機能の活用</li>
</ul>
</li>
<li>Software Supply Chain
<ul>
<li>どうコンテナイメージに脆弱性がないことを保証するか</li>
<li>ビルドされたイメージが deploy されるまでに改ざんされないことをどう担保するか</li>
</ul>
</li>
<li>Runtime Security
<ul>
<li>コンテナが不審な挙動を示した時</li>
<li><em>メモ間に合わず</em></li>
</ul>
</li>
</ul>
</li>
<li>コンテナセキュリティの脅威とリスク
<ul>
<li>インフラ
<ul>
<li>権限昇格</li>
<li>機密漏えい</li>
</ul>
</li>
<li><em>メモムリ</em></li>
</ul>
</li>
<li>GKE: Use RBAC and IAM
<ul>
<li>プロジェクトレベルで IAM を使う</li>
<li>クラスタ/ネームスペースでは RBAC を使う</li>
</ul>
</li>
<li>プライベートクラスタと承認済みネットワーク
<ul>
<li>K8s の master も承認済みネットワークのみからのアクセスに限定できる</li>
</ul>
</li>
<li>Cloud Armor
<ul>
<li>スケーラブルな WAF</li>
<li>DDoS 防御</li>
<li>IP アドレス制御</li>
<li>LB で WAF を使える</li>
<li>BackendConfig(beta)で GKE でも使える</li>
</ul>
</li>
<li>Software Supply Chain
<ul>
<li>どうコンテナイメージに脆弱性がないことを保証するか</li>
<li>ビルドされたイメージが deploy されるまでに改ざんされないことをどう担保するか</li>
<li>CI/CD パイプラインを作っただけでは信頼できない deploy を止めることはできない</li>
<li>イメージのメタデータ
<ul>
<li>意図したところでビルドされたか</li>
<li>意図したテストが実施済みか</li>
</ul>
</li>
<li>イメージのメタデータをもとに判断</li>
<li>GKE ではどう作れるか?
<ul>
<li>コンテナレジストリの脆弱性スキャン
<ul>
<li>パッチ未適用による脆弱性が多い</li>
</ul>
</li>
<li>バイナリオーサライゼーション
<ul>
<li>検証済みイメージのみがビルドリリースプロセスに乗る</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Runtime セキュリティ
<ul>
<li>Container Optimized OS
<ul>
<li>GKE のデフォルト</li>
<li>セキュアで軽量な OS</li>
<li>ChromiumOS ベース</li>
</ul>
</li>
<li>Runtime security partners in Cloud SCC (beta)</li>
</ul>
</li>
</ul>
<h3 id="理由-2-network">理由 2 Network</h3>
<ul>
<li>ざまざまな GCP サービスとの統合
<ul>
<li>Google Cloud Load Balancing
<ul>
<li>エニーキャスト
<ul>
<li>ユーザーの近いところでリクエスト受けてくれる</li>
</ul>
</li>
</ul>
</li>
<li>Google のグローバルインフラを使える</li>
<li>Container Native Load Balancing (beta)
<ul>
<li>通常は、一旦 VM にリクエスト振られるのでダブルホップ問題生じる</li>
<li>CN LB 使うとリクエストがダイレクトにコンテナに届く</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="理由-3-hybrid-cloud">理由 3 Hybrid Cloud</h3>
<ul>
<li>適材適所
<ul>
<li>ゴール: コードをどこでも実行できる環境を整える</li>
<li>とはいえマネージド k8s サービスごとに得手不得手がある</li>
<li>K8s のリソースをどう実装するかがマネージド k8s サービスの差別化ポイントになる</li>
<li>あるいはオンプレで GPU を購入してるケースなど</li>
</ul>
</li>
<li>GCP Solution: GKE On-Prem (beta)
<ul>
<li>オンプレのクラスタを GCP Console から一元的に管理できる</li>
<li>オンプレも StackDriver で可観測性を提供
<ul>
<li>Google Fluentd 入れればいけるとかそんな?</li>
</ul>
</li>
</ul>
</li>
<li>クラスタ集中管理のメリット
<ul>
<li>同じツール使える</li>
</ul>
</li>
</ul>
<h4 id="事例-メルカリさん">事例: メルカリさん</h4>
<ul>
<li>元はオンプレのモノリス構成</li>
<li>マイクロサービス化
<ul>
<li>徐々にマイクロサービス化</li>
<li>マイクロサービス化が完了したサービスから GKE に乗せていく</li>
</ul>
</li>
<li>オンプレで動かした方が良いワークロードはオンプレに残せる</li>
<li>今後
<ul>
<li>オンプレリソースも k8s に寄せて GKE で管理したい</li>
<li>Istio 導入したい</li>
</ul>
</li>
</ul>
<h3 id="理由-4-observability">理由 4 Observability</h3>
<ul>
<li>可観測性</li>
<li>Logging の鍵
<ul>
<li>GCP の内外の情報をどう集めるか</li>
</ul>
</li>
<li>Monitoring
<ul>
<li>単に見せるだけではなく適切なアラートを送る必要</li>
</ul>
</li>
<li>何が課題か
<ul>
<li>モノリスと比べて対象リソースが増える</li>
<li>包括的に Logging/Monitoring する必要がある</li>
<li>DevOps/SRE,Dev,SecOps 等の役割ごとに見るメトリクスが違う</li>
</ul>
</li>
<li>GCP Solution: Stackdriver
<ul>
<li>Logging/Monitoring を提供する統合基盤</li>
<li>Stackdriver k8s Monitoring(beta)
<ul>
<li>K8s のワークロード監視に最適化された Stackdriver のツール</li>
<li>ノードの CPU/mem に加えて Pod,コンテナの CPU/mem もみれる、アラートも出せる</li>
<li>クリックすると Logging 画面に遷移、同じ画面で Monitoring/Logging 両方みれる</li>
<li>既存の Stackdriver ユーザーも移行できる</li>
<li>新規の場合はボタン 1 つクリックするだけ</li>
</ul>
</li>
</ul>
</li>
<li>Works With Open Source: Prometheus
<ul>
<li>Stackdriver とのシームレスなインテグレーション</li>
<li>Istio 使った場合は?=&gt;この後のセッションで</li>
</ul>
</li>
</ul>
<h3 id="理由-5-contribution">理由 5: Contribution</h3>
<ul>
<li>Open Source is free like puppy
<ul>
<li>子犬のようなもの</li>
<li>世話をし続ける必要がある</li>
<li>「k8s の機能を 1 つリリースした」では不十分</li>
</ul>
</li>
<li>コンテナと k8s の歴史
<ul>
<li>Google の貢献の歴史</li>
</ul>
</li>
<li>GKE はどこにいくのか?
<ul>
<li>GKE is going to …
<ul>
<li>To be Reliable</li>
<li>To be Scalable</li>
<li>To be Open</li>
</ul>
</li>
</ul>
</li>
<li>To be Reliable
<ul>
<li>Regional Cluster GA since Q3’18</li>
<li>Regional Persistent Disks(beta)
<ul>
<li>ゾーン障害があっても大丈夫</li>
</ul>
</li>
</ul>
</li>
<li>To be Scalable
<ul>
<li>Scalability of GKE
<ul>
<li>Pod/Node 両方の水平/垂直スケーリング</li>
</ul>
</li>
<li>Node Auto-Provisioning (beta)
<ul>
<li>適切なサイズのインスタンスを持つ新しいノードプールを作成</li>
<li>自動?</li>
</ul>
</li>
</ul>
</li>
<li>To be Open
<ul>
<li>OSS friendly ecosystem
<ul>
<li>Skaffold</li>
<li>Kanico</li>
<li>Knative</li>
</ul>
</li>
<li><a href="https://github.com/GoogleContainerTools">GitHub の GoogleContainerTools</a>みてね！</li>
</ul>
</li>
</ul>
<h3 id="感想-1">(感想)</h3>
<p>GCP/GKE の beta を含めたいろいろな機能のご紹介が大変興味深かったです。<br>
今度会社で SA の方を通じて詳しく教えていただこうと思いました。</p>
<h2 id="gke-を用いたレガシーシステムからのリプレース事例">GKE を用いたレガシーシステムからのリプレース事例</h2>
<h3 id="自己紹介">自己紹介</h3>
<ul>
<li>FUJIFILM Prints &amp; Gifts のバックエンド作ってる
<ul>
<li>プリントや写真雑貨を注文できるサービス</li>
<li>ましかくプリント
<ul>
<li>手のひらに収まるサイズの正方形の写真</li>
<li>フチのパターンをカスタマイズできる</li>
</ul>
</li>
<li>WALL DECOR
<ul>
<li>壁掛け写真</li>
</ul>
</li>
<li>写真雑貨</li>
</ul>
</li>
</ul>
<h3 id="プロジェクト概要">プロジェクト概要</h3>
<ul>
<li>ネットプリントサービスの運用が 10 年越えた
<ul>
<li>機能改善スピード低下してた</li>
<li>ユーザーの消費動向が変わった</li>
<li>リプレイスしよう！</li>
<li>フロントエンドの動線が複雑</li>
<li>一部商品の合わせ買いができない</li>
<li>バックエンドはサブシステム単位で分割されていた</li>
</ul>
</li>
<li>リプレイス後
<ul>
<li>フロントエンドの動線をシンプルにした</li>
<li>カートが統一された</li>
<li>OMS(バックエンド)はマイクロサービス化
<ul>
<li>中央に GKE、周りにマネージドサービス</li>
<li>イベント駆動</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="gke-利用までの経緯">GKE 利用までの経緯</h3>
<ul>
<li>富士フィルムの文化
<ul>
<li>See と Think を重要視</li>
<li>S-&gt;T-&gt;PDCA</li>
</ul>
</li>
<li>現状分析
<ul>
<li>保守コスト増大の原因は?
<ul>
<li>品質担保難しい</li>
<li>保守要員の学習コスト高い</li>
<li>影響範囲の見極めが難しい</li>
<li>モノリシックなアプリケーションだから?</li>
</ul>
</li>
<li>運用コスト増大の原因は?
<ul>
<li>システム構成変更コストが大きい</li>
<li>季節イベントごとの負荷状況に応じたシステム増設コストが大きい
<ul>
<li>年賀状</li>
</ul>
</li>
</ul>
</li>
<li>別にモノリシックを志向したわけではない
<ul>
<li>先人も工夫してきたようだが。。</li>
</ul>
</li>
</ul>
</li>
<li>負荷量変動への対応を最優先にする！
<ul>
<li>スケーラビリティ確保しやすい仕組みを最優先にする</li>
<li>コンテナを使う</li>
<li>他の問題も解消できそう</li>
<li>機が熟した</li>
<li>コンテナを利用した実績がなかった
<ul>
<li>新技術導入に不安の声もあった</li>
<li>チャレンジさせてほしいと説得</li>
</ul>
</li>
</ul>
</li>
<li>オーケストレーションツールは使いたい
<ul>
<li>何が標準か?
<ul>
<li>流行度</li>
<li>ベンダーの覇権争い</li>
<li>仕様策定状況
<ul>
<li>JS フレームワークで辛かった思い出がある</li>
</ul>
</li>
</ul>
</li>
<li>運用できるか?
<ul>
<li>運用に耐えうるか</li>
<li>自分たちが理解できるか</li>
<li>デモではない</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="コンテナやオーケストレーションツールの調査">(コンテナやオーケストレーションツールの)調査</h3>
<ul>
<li>Docker と k8s に絞って調査
<ul>
<li>Docker 社の OSS リリース</li>
<li>Google が「すでにコンテナ使ってるよ」リリース</li>
<li>Docker, Docker Swarm, k8s など</li>
<li>OCI 発足=&gt;標準化進んだ</li>
<li>K8s v1.0 が出て CNCF 設立
<ul>
<li>ベンダーロックインなくなった</li>
</ul>
</li>
<li>OCI 1.0</li>
<li>Docker が k8s サポートを発表
<ul>
<li>=&gt; k8s が事実上標準になった</li>
</ul>
</li>
<li>AKS, EKS の発表</li>
<li>CRI(通信インタフェース)も標準化された</li>
<li>デファクトスタンダードが定まった</li>
<li>マネージドサービスが整った</li>
</ul>
</li>
<li>クラウドベンダーの選定(GKE 選定理由)
<ul>
<li>日本国内で提供されてる k8s サービスは当時 GKE だけ</li>
<li>Google は k8s 開発元で安心</li>
<li>マネージド k8s の 4 年以上の安定運用実績</li>
</ul>
</li>
</ul>
<h3 id="取り組む上での課題組織面">取り組む上での課題(組織面)</h3>
<ul>
<li>周りの理解
<ul>
<li>なんで使うの?</li>
<li>技術的優位性は?</li>
<li>細かくいろいろな質問が出てくる</li>
<li>新技術でスケジュール遵守できる?</li>
</ul>
</li>
<li>近道はなかった
<ul>
<li>資料作って説明-&gt;指摘受けて修正</li>
<li>熱意が必要だった</li>
</ul>
</li>
<li>現場では味方が多かった
<ul>
<li>10 年ものの構成をみんな良いとは思ってなかった</li>
<li>何れにしてもリプレイスするしかない</li>
<li>相談できた</li>
<li>技術学習の協力が得られた</li>
</ul>
</li>
<li>リスクの背負い方
<ul>
<li>明確な解はなかった</li>
<li>バックアッププランの準備と提案</li>
<li>技術習得していることの説明</li>
<li>Google のサポート</li>
</ul>
</li>
</ul>
<h3 id="取り組む上での課題開発面">取り組む上での課題(開発面)</h3>
<ul>
<li>最初の課題は技術習得
<ul>
<li>GKE/GCP/コンテナ/オーケストレーション使用経験なし
<ul>
<li>Azure は使ったことあった</li>
</ul>
</li>
<li>独学+ハンズオンで基礎固め</li>
<li>Google エンジニアのサポート</li>
<li>トライアンドエラーで学習
<ul>
<li>(GKE は)トライアンドエラーしやすい環境だった</li>
</ul>
</li>
</ul>
</li>
<li>事前調査
<ul>
<li>レガシーシステム自体のルール把握
<ul>
<li>調査はしたが完全には無理だった</li>
<li>実施してから発覚したこともある</li>
</ul>
</li>
<li>効率的なシステム間連携は知識が必要
<ul>
<li>Pub/sub 連携のイベント発火条件などは当初は無駄が多かった</li>
<li>徐々にリファクタリングしていった
<ul>
<li>よりマネージドサービス活用する構成にしていった</li>
<li>最初からはできなかった</li>
</ul>
</li>
</ul>
</li>
<li>運用
<ul>
<li>ログやアラートは最終的にはなんとかなった</li>
<li>メトリクスの書き方はドキュメントだけでは満たせず Google SA に聞いた</li>
</ul>
</li>
<li>設計/設定
<ul>
<li>K8s 設定記述方法
<ul>
<li>Yaml の書き方に慣れるのに時間かかった</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>基本設計
<ul>
<li>できるだけ細かく分割しようとした
<ul>
<li>動くものはできた</li>
<li>しかし制御不能、指摘も多かった</li>
<li>異常系大変だった</li>
</ul>
</li>
<li>ある程度の粒度で分割
<ul>
<li>マイクロサービスの思想は取り入れた</li>
<li>何が何でも分割すればいいというものではない</li>
</ul>
</li>
</ul>
</li>
<li>商用利用に向けての課題
<ul>
<li>マネージドサービスでできる範囲の見極め</li>
<li>監視面は社内の他のシステムと合わせたかった
<ul>
<li>すでにリッチな監視系があった</li>
<li>GCP デフォルトでは足りなかった</li>
<li>最終的には Prometheus 使った</li>
</ul>
</li>
</ul>
</li>
<li>レガシーシステムとの連携
<ul>
<li>レガシーシステム側を変えることは無理</li>
<li>IP アドレス制限や古いプロトコルへの対応が必要だった</li>
<li>当初は不要にできる見込みだったが捨てきれなかった</li>
</ul>
</li>
</ul>
<h3 id="効果">効果</h3>
<ul>
<li>スケーラビリティは確保できた
<ul>
<li>スケールすべきものとしなくてもいいものを分離できた</li>
<li>負荷が高い機能も切り出しやすくなった</li>
<li>リージョンまたぎや今後の横展開も行いやすい構成にできた</li>
</ul>
</li>
<li>保守運用コスト削減もできた
<ul>
<li>影響範囲を限定できた</li>
<li>学習コストも分離できた</li>
<li>ランニングコストが 3/5 になった</li>
<li>サーバー構築不要になった</li>
<li>ログ/アラートが一元管理可能になった
<ul>
<li>調査しやすい</li>
<li>蓄積できる</li>
</ul>
</li>
<li>導入 8 ヶ月でサービスダウンなし</li>
</ul>
</li>
<li>機能改善スピードも向上した
<ul>
<li>影響範囲が見極めやすくなった</li>
<li>イベント開催にも対応できるようになった</li>
</ul>
</li>
</ul>
<h3 id="取り組んでみて">取り組んでみて</h3>
<ul>
<li>GKE の学習コストは高かったが得られる効果が大きかったのでコストパフォーマンスは良かった</li>
<li>すぐに動かせるのは良かった</li>
<li>GCP ドキュメント充実してた
<ul>
<li>使いこなしはこれから</li>
</ul>
</li>
<li>アプリ開発に集中でき、インフラ懸念を大きく払拭できた
<ul>
<li>サービスが死なない(セルフヒーリング)</li>
<li>調査はするが障害復旧に時間取られない</li>
</ul>
</li>
<li>組織の壁は厚い
<ul>
<li>乗り越えるには熱意</li>
<li>仲間大事</li>
</ul>
</li>
<li>Google の人の協力偉大</li>
</ul>
<h3 id="感想-2">(感想)</h3>
<p>レガシーサービス運用のつらみは大変共感できました。<br>
根回しや各種調整含めて熱意を持って挑まれていて素晴らしかった。</p>
<h2 id="コンテナによる開発と運用の進化">コンテナによる開発と運用の進化</h2>
<p>「今日はマイクロサービスの話をします」とのこと。<br>
会場で実際にマイクロサービス作ってる人はまだ少なめだった。<br>
実際にマイクロサービスでサービス提供するには?</p>
<h3 id="製品ライフサイクル">製品ライフサイクル</h3>
<ul>
<li>ライフサイクル
<ul>
<li>コンセプト</li>
<li>ビジネス</li>
<li>開発</li>
<li>運用</li>
<li>一般公開</li>
</ul>
</li>
<li>いかにライフサイクルを早く回すか
<ul>
<li>早く価値を届ける</li>
</ul>
</li>
<li>3 つのポイント
<ul>
<li>人(ビジネス/技術)
<ul>
<li>CxO, Manager, Business, Tech</li>
<li>DevOps, SRE</li>
</ul>
</li>
<li>プロセス
<ul>
<li>Scrum(アジャイル), Waterfall</li>
</ul>
</li>
<li>テクノロジー
<ul>
<li>クラウド, マイクロサービスアーキテクチャ, CI/CD</li>
</ul>
</li>
</ul>
</li>
<li>マイクロサービスアーキテクチャの活用は技術だけではない</li>
<li>Change Management
<ul>
<li>変化をうまく管理していこう</li>
<li>興味があれば Google, Google パートナーがサポートプログラムを提供してるのでお声がけください</li>
<li>Cloud Next でも扱ってるよ</li>
</ul>
</li>
<li>今日はテクノロジに絞った話</li>
</ul>
<h3 id="マイクロサービスとは">マイクロサービスとは</h3>
<ul>
<li>2014 年に提唱
<ul>
<li>機能ごとに独立したアプリケーションに分割</li>
<li>各サービスは単一の目的を持つ</li>
<li>個々のアプリケーションを独立してリリースできる</li>
<li>分散システム</li>
<li>サービス間は疎結合</li>
<li>軽量な WebAPI などでやり取り</li>
</ul>
</li>
<li>ASIs to ToBe (Monolith to MIcroservice)
<ul>
<li>新規サービスから</li>
<li>既存サービスを部分的に
<ul>
<li>実際は大体こちらですよね</li>
<li>Domain を抜き出しマイクロサービス化する
<ul>
<li>レコメンドだけ抜き出す</li>
<li>ユーザー管理だけ抜き出す</li>
</ul>
</li>
<li>もう少し大きく部署相当機能でマイクロサービス化する
<ul>
<li>EC サービス関連だけマイクロサービス化する</li>
</ul>
</li>
<li>ビジネス側の関係者が多いとイテレーションが遅くなる
<ul>
<li>理想は開発チームとビジネスチームが 1:1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The Problem
<ul>
<li>分散アーキテクチャへの移行
<ul>
<li>これまでのモノリシックなアーキテクチャ向けの方法では監視/管理/保護が困難</li>
</ul>
</li>
</ul>
</li>
<li>4 challenges of Microservices
<ul>
<li>プロセス内コミュニケーション → プロセス外コミュニケーション
<ul>
<li>RPC+API Gateway</li>
</ul>
</li>
<li>管理
<ul>
<li>サービスメッシュ</li>
</ul>
</li>
<li>マイクロサービス境界とデータサイロ
<ul>
<li>データレイク</li>
</ul>
</li>
<li>アプリケーション外のコーディングを減らす
<ul>
<li>CI/CD</li>
<li>このセッションのスコープ外
<ul>
<li>F/O さんのセッションで触れられる</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>プロセス外コミュニケーション
<ul>
<li>呼び出し先マイクロサービスのトラッキングが困難</li>
<li>ビルド時に API の不整合を検知できない</li>
<li>ルールや技術で工夫してイテレーション速度を担保</li>
<li>宣言的に API を管理
<ul>
<li>REST API (HTTP 1.1)
<ul>
<li>Open API でメッセージフォーマットを定義</li>
<li>互換性管理の竹のガイドライン作成(推奨)</li>
</ul>
</li>
<li>gRPC (HTTP 2.0)
<ul>
<li>Protocol Buffers でメッセージフォーマットを定義</li>
<li>Language Guide に従うと下位互換性の担保が容易</li>
</ul>
</li>
<li>スタブの自動生成</li>
<li>バリデーション</li>
</ul>
</li>
<li>API のバージョン管理
<ul>
<li>Goo.gl/mgbJv8</li>
<li>Google での API バージョン管理ベストプラクティスを公開</li>
<li>Cloud Endpoint で実現をサポート</li>
<li>セマンティックバージョニングで管理
<ul>
<li>マイナーバージョンアップデートは後方互換性担保</li>
<li>メジャーバージョンアップデートは後方互換性なし</li>
</ul>
</li>
</ul>
</li>
<li>API 設計ガイド
<ul>
<li>cloud.google.com/apis/design/</li>
</ul>
</li>
<li>Cloud Endpoints によるマイクロサービスの実現
<ul>
<li>API Keys -&gt; Cloud Endpoints -&gt; Stackdriver logging -&gt; Visualize</li>
<li>Stackdriver logging: API コールのログと API Key を紐づけて管理</li>
<li>Visualize: BigQuery + Data ポータル</li>
<li>内部で使ってる gRPC の API を外部向けに REST で提供したりできる</li>
</ul>
</li>
<li>可観測性 w/ GCP(事例)
<ul>
<li>Stackdriver Products</li>
<li>Prometheus</li>
<li>通信制御は Istio 使っていきたい</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="サービスメッシュ">サービスメッシュ</h3>
<ul>
<li>サービスメッシュとは?
<ul>
<li>マイクロサービスにするとシステムが複雑化する</li>
<li>システム管理を簡略化する
<ul>
<li>サービスディスカバリ</li>
</ul>
</li>
<li>サイドカーと呼ばれるネットワークプロクシ</li>
</ul>
</li>
<li>Istio
<ul>
<li>Google と IBM が中心に開発</li>
<li>OSS</li>
<li>プロクシとして Envoy を使う</li>
<li>GKE ではボタン押せば使える</li>
</ul>
</li>
<li>Istio の価値
<ul>
<li>トラフィックコントロール
<ul>
<li>バージョンを上げた時にローリングアップデートしたい</li>
<li>今までだと LB で制御してた</li>
<li>Istio 使うと Istio にお任せできる</li>
<li>旧バージョンに 90%流すとか</li>
</ul>
</li>
<li>セキュリティ
<ul>
<li>これまではマイクロサービス間は素通し</li>
<li>Istio を使うとマイクロサービス間の通信制御ができる
<ul>
<li>暗号化もできる</li>
</ul>
</li>
<li>Role Based Access Control
<ul>
<li>ユーザーへの認可もできる</li>
</ul>
</li>
</ul>
</li>
<li>可観測性
<ul>
<li>Istio の監視
<ul>
<li>MIxer でテレメトリの収集
<ul>
<li>マイクロサービス間でのトラフィック</li>
</ul>
</li>
</ul>
</li>
<li>GUI のインタフェースもある</li>
</ul>
</li>
<li>Istio on GCP の機能、ロードマップ
<ul>
<li>Istio on GKE</li>
<li>〜</li>
</ul>
</li>
</ul>
</li>
<li>データレイク
<ul>
<li>各マイクロサービスごとにデータを持つ</li>
<li>データがサイロになってしまう</li>
<li>各マイクロサービスから pub/sub に分析に必要なデータを送り込む</li>
<li>Pub/sub からデータレイクにデータを集めて分析できる</li>
</ul>
</li>
</ul>
<h3 id="istio--csm-demo">(Istio / CSM Demo)</h3>
<h3 id="感想-3">(感想)</h3>
<p>ようやく Istio が何なのかイメージ湧いた気がします。<br>
Managed Istio と WebUI が大変興味深くて期待。</p>
<h2 id="freakout-の広告プロダクトでの-gke-活用事例と-gke-新機能の導入について">FreakOut の広告プロダクトでの GKE 活用事例と GKE 新機能の導入について</h2>
<p>Google Cloud INSIDe Digital の内容が含まれるとのこと。</p>
<h3 id="自己紹介会社紹介">自己紹介/会社紹介</h3>
<ul>
<li>F/O の CTO やってます</li>
<li>2010 年創業</li>
<li>国内初 DSP</li>
<li>今は DSP 以外も色々やってる</li>
<li>グループ全体 632 名, エンジニア 60 名</li>
</ul>
<h3 id="fo-の広告プロダクト紹介">F/O の広告プロダクト紹介</h3>
<ul>
<li>DSP
<ul>
<li>Red(FreakOut DSP)</li>
<li>国内初かつ国内最大級</li>
<li>350,000 Req/sec</li>
<li>20 Billion Req/day</li>
<li>600 Billion Req/month</li>
<li>オンプレ 700 台で構成</li>
</ul>
</li>
<li>ASE
<ul>
<li>位置情報マーケティングプラットフォーム</li>
<li>位置情報ターゲティング広告</li>
<li>インフラは AWS</li>
</ul>
</li>
<li>Red for Publishers
<ul>
<li>アドネットワークを作れるプロダクト</li>
<li>アドネットワークの基盤</li>
<li>海外拠点立ち上げ時にアドネットワークをすぐ作れる</li>
<li>GCP でホスト</li>
<li>日本では Poets という名前</li>
<li>Go+Perl</li>
<li>GCP で事例紹介されてる</li>
</ul>
</li>
<li>LayApp
<ul>
<li>アプリエンゲージメントプラットフォーム</li>
<li>アプリデベロッパーの収益機会最大化支援</li>
<li>ユーザーセグメンテーション</li>
<li>機械学習でエンゲージメント配信</li>
<li>GCP ＋ ML Engine 使ってる</li>
</ul>
</li>
</ul>
<h3 id="プロダクション環境での-gke-運用">プロダクション環境での GKE 運用</h3>
<ul>
<li>100%GCP で構成</li>
<li>アプリは全部 GKE で動いてる
<ul>
<li>ワークロードごとにクラスタ分けれてる</li>
</ul>
</li>
<li>GKE 1.10.11 を使ってる</li>
<li>広告配信、UI、バッチ</li>
<li>CronJob (&gt;= k8s 1.8)使ってる</li>
<li>カナリアリリース環境を用意
<ul>
<li>特定の Git ブランチを少量の Pod に deploy して本番トラフィック流せる</li>
</ul>
</li>
<li>Stackdriver を活用してる
<ul>
<li>Monitoring
<ul>
<li>Prometheus と併用</li>
<li>UI は Grafana 使ってる
<ul>
<li>見やすい、使い勝手良い</li>
</ul>
</li>
<li>k8s Monitoering 導入検討中</li>
</ul>
</li>
<li>Logging
<ul>
<li>コンテナのエラーログを集約</li>
<li>アラート: pub/sub -&gt; cloud functions -&gt; Slack</li>
</ul>
</li>
<li>Profiler
<ul>
<li>常に最新のコードのプロファイルを可視化、比較</li>
</ul>
</li>
</ul>
</li>
<li>BigQuery
<ul>
<li>全てのアクセスログ、アプリログを集約してる
<ul>
<li>数十億レコード/day</li>
</ul>
</li>
<li>fluend 経由
<ul>
<li>サイドカー</li>
<li>ストリームインサート!</li>
<li>A/b テストの結果をすぐに集約できる</li>
</ul>
</li>
<li>可視化は re:dash</li>
<li>MySQL のマスタデータもインポートしてる</li>
</ul>
</li>
<li>Vulnerability scanning(beta)
<ul>
<li>Alpine メインなので対象</li>
<li>脆弱性はリリースタイミングとは別のタイムラインで出現する</li>
<li>Pub/sub で通知されるので cloud functions で subscribe して Slack 通知</li>
</ul>
</li>
<li>Customize
<ul>
<li>K8s の yaml のカスタマイズができる</li>
<li>Kubectl のサブツールとしてマージされた</li>
<li>Production/stg/canary など環境ごとの設定を上書きしてる
<ul>
<li>Replicas</li>
<li>環境変数</li>
<li>Configmap</li>
</ul>
</li>
</ul>
</li>
<li>Other tools
<ul>
<li>Stern
<ul>
<li>複数コンテナのログを端末で素早く確認できる</li>
<li>Tails -F のようなイメージ</li>
</ul>
</li>
<li>Kubectx
<ul>
<li>クラスタ切り替え
<ul>
<li>Prod/stg/dev 等</li>
</ul>
</li>
<li>同梱の kubens でネームスペースも切り替え</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="gke-での-cicd">GKE での CI/CD</h3>
<ul>
<li>Tools
<ul>
<li>GitHub</li>
<li>CircleCI</li>
<li>Cloud Build</li>
<li>Cloud Container Registry</li>
<li>Cloud pub/sub</li>
<li>Cloud &hellip; <em>メモれなかった</em></li>
</ul>
</li>
<li>CI のフロー
<ul>
<li>GitHub に push</li>
<li>テスト&amp;ビルド
<ul>
<li>CircleCI</li>
<li>Cloud Build
<ul>
<li>Master: 本番用</li>
<li>Develop: カナリアリリース</li>
</ul>
</li>
</ul>
</li>
<li>カナリアリリース
<ul>
<li>エンジニアが手動で 1pod - 数 pods に deploy</li>
<li>Spineker とかで自動化できそうだが今の所手動で足りてる</li>
</ul>
</li>
</ul>
</li>
<li>CD のフロー
<ul>
<li>GitHUb で PR マージ</li>
<li>Build &amp; deploy ( cloud build)
<ul>
<li>Docker build</li>
<li>Docker push</li>
<li>Kubectl set image
<ul>
<li>kustomize 使いたい</li>
</ul>
</li>
</ul>
</li>
<li>Notification
<ul>
<li>Pub/sub への publish</li>
<li><em>メモ追いつかなかった</em></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="gke-の新機能を活用した-k8s-環境構築">GKE の新機能を活用した k8s 環境構築</h3>
<ul>
<li>VPC native cluster (alias IP)
<ul>
<li>Scale enhancements</li>
<li>Hybrid connectivity</li>
<li>Better VPC integration</li>
<li>Security checks</li>
<li>IP address management</li>
</ul>
</li>
<li>Cloud Memorystore for Redis</li>
<li>Cloud NAT
<ul>
<li>マネージド NAT</li>
<li>アウトバウンドの Gateway</li>
<li>要 Private Cluster</li>
<li>外部アクセスの接続元 IP アドレスを限定する
<ul>
<li>IP アドレスの事前登録が必要なケースとか</li>
</ul>
</li>
<li>Region, network, subnetwork に Cloud NAT のものを指定</li>
</ul>
</li>
<li>Network Endpoint Groups
<ul>
<li>コンテナネイティブな負荷分散が可能</li>
<li>Instance Group は iptables を介して pod にルーティングされる</li>
<li>NEGs は Pod を直接ターゲットにできる</li>
<li>設定簡単</li>
</ul>
</li>
<li>BackendConfig custom resource
<ul>
<li>GKE の ingress コントローラにカスタムリソースを定義できる
<ul>
<li>Balancer Settings
<ul>
<li>タイムアウト設定</li>
<li>接続ドレインタイムアウトの設定</li>
<li>Session affinity をクッキーベースにする</li>
</ul>
</li>
<li>Cloud Armor
<ul>
<li>DDoS 攻撃からアプリを守る</li>
<li>IP アドレスのホワイトリスト/ブラックリスト
<ul>
<li>社内ツールへのアクセス元 IP アドレス制御</li>
</ul>
</li>
</ul>
</li>
<li>Cloud IAP
<ul>
<li>LB に認証機能を追加できる
<ul>
<li>任意の URL に Google 認証をかけられる</li>
<li>E.g. Grafana に認証をかけるなど</li>
</ul>
</li>
</ul>
</li>
<li>Cloud CDN
<ul>
<li>キャッシュポリシーの設定を k8s の config で行える</li>
</ul>
</li>
<li>Google managed SSL certificates(beta)
<ul>
<li>マネージド SSL(無料)</li>
<li>中身は Let’s Encrypt</li>
<li>自動更新される</li>
<li>Ingress アノテーションで紐づける</li>
</ul>
</li>
</ul>
</li>
<li>Service と BackendConfig を紐づけて使う</li>
</ul>
</li>
</ul>
<h3 id="まとめ">まとめ</h3>
<ul>
<li>GCP を活用して複数の広告プロダクトを開発/運用してる</li>
<li>アプリは GKE/k8s 上で動いてる</li>
<li>運用に Stackdriver 便利</li>
<li>CI/CD の構築も容易(Cloud Build)</li>
<li>GKE では GCP の最新機能使える</li>
</ul>
<h3 id="感想-4">(感想)</h3>
<p>複数の広告プロダクトの開発/運用のお話が大変実践的で勉強になりました。<br>
オンプレ/AWS/GCP と併用されている中で、GCP の認証は Google 認証に寄せられるにしても他のシステムとの認証の連携は大変そうだと感じた。<br>
機会があればこの辺りのお話を伺いたい。</p>
<h2 id="運営周りの感想">運営周りの感想</h2>
<p>運営(いわゆるロジ)周りも素晴らしくて参考になったのでメモしてました。<br>
勉強会やイベントの運営に携わらせていただく機会が多いので参考になる。</p>
<ul>
<li>タイムキープすばらしかった
<ul>
<li>一番前に居たのでタイムキーパーの方の動きが見えた</li>
<li>登壇者の方みなさん時間ぴったりだった、たぶん</li>
</ul>
</li>
<li>撮影
<ul>
<li>動画/静止画複数行われていた模様</li>
</ul>
</li>
<li>アナウンスが素晴らしかった
<ul>
<li>メインスクリーンに 10 秒おきくらいに必要な情報でる</li>
<li>開始まで繰り返しアナウンス</li>
<li>紙のパンフレットにも案内あり</li>
</ul>
</li>
<li>設備素晴らし
<ul>
<li>全席テーブルあり</li>
<li>Wi-Fi</li>
<li>充電コーナー</li>
<li>ケータリング
<ul>
<li>コーヒーカップにフタ欲しかった
<ul>
<li>こぼしそうで怖い</li>
<li>準備してくださった模様
<ul>
<li><a href="https://twitter.com/mapk0y/status/1110404023088091136">https://twitter.com/mapk0y/status/1110404023088091136</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

    </article>
  </div>
  <div class="col-lg-3">
    <div class="sidebar">
  
  <h4><a href="/ja/about/">About</a></h4>
  <p><strong>Hidenori MATSUKI</strong></p>
<p>🍣 🍶</p>
<p>another website: <a href="https://mazgi.com/">mazgi.com</a></p>
  
  <hr />
  <h4>TableOfContents</h4>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#keynote">Keynote</a>
      <ul>
        <li></li>
        <li><a href="#感想">(感想)</a></li>
      </ul>
    </li>
    <li><a href="#コンテナ開発プラットフォームに-gke-を選択すべき-7-つの理由">コンテナ開発プラットフォームに GKE を選択すべき 7 つの理由</a>
      <ul>
        <li><a href="#理由-1-security">理由 1 Security</a></li>
        <li><a href="#理由-2-network">理由 2 Network</a></li>
        <li><a href="#理由-3-hybrid-cloud">理由 3 Hybrid Cloud</a></li>
        <li><a href="#理由-4-observability">理由 4 Observability</a></li>
        <li><a href="#理由-5-contribution">理由 5: Contribution</a></li>
        <li><a href="#感想-1">(感想)</a></li>
      </ul>
    </li>
    <li><a href="#gke-を用いたレガシーシステムからのリプレース事例">GKE を用いたレガシーシステムからのリプレース事例</a>
      <ul>
        <li><a href="#自己紹介">自己紹介</a></li>
        <li><a href="#プロジェクト概要">プロジェクト概要</a></li>
        <li><a href="#gke-利用までの経緯">GKE 利用までの経緯</a></li>
        <li><a href="#コンテナやオーケストレーションツールの調査">(コンテナやオーケストレーションツールの)調査</a></li>
        <li><a href="#取り組む上での課題組織面">取り組む上での課題(組織面)</a></li>
        <li><a href="#取り組む上での課題開発面">取り組む上での課題(開発面)</a></li>
        <li><a href="#効果">効果</a></li>
        <li><a href="#取り組んでみて">取り組んでみて</a></li>
        <li><a href="#感想-2">(感想)</a></li>
      </ul>
    </li>
    <li><a href="#コンテナによる開発と運用の進化">コンテナによる開発と運用の進化</a>
      <ul>
        <li><a href="#製品ライフサイクル">製品ライフサイクル</a></li>
        <li><a href="#マイクロサービスとは">マイクロサービスとは</a></li>
        <li><a href="#サービスメッシュ">サービスメッシュ</a></li>
        <li><a href="#istio--csm-demo">(Istio / CSM Demo)</a></li>
        <li><a href="#感想-3">(感想)</a></li>
      </ul>
    </li>
    <li><a href="#freakout-の広告プロダクトでの-gke-活用事例と-gke-新機能の導入について">FreakOut の広告プロダクトでの GKE 活用事例と GKE 新機能の導入について</a>
      <ul>
        <li><a href="#自己紹介会社紹介">自己紹介/会社紹介</a></li>
        <li><a href="#fo-の広告プロダクト紹介">F/O の広告プロダクト紹介</a></li>
        <li><a href="#プロダクション環境での-gke-運用">プロダクション環境での GKE 運用</a></li>
        <li><a href="#gke-での-cicd">GKE での CI/CD</a></li>
        <li><a href="#gke-の新機能を活用した-k8s-環境構築">GKE の新機能を活用した k8s 環境構築</a></li>
        <li><a href="#まとめ">まとめ</a></li>
        <li><a href="#感想-4">(感想)</a></li>
      </ul>
    </li>
    <li><a href="#運営周りの感想">運営周りの感想</a></li>
  </ul>
</nav>
  <hr />
  <h4><a href="/ja/categories/">Categories</a></h4>
  
  <div>
    <ul>
      
      <li>
        <a href="/ja/categories/event/">event</a>
      </li>
      
    </ul>
  </div>
  
  <hr />
  <h4><a href="/ja/tags/">Tags</a></h4>
  
  <div>
    
    <a class="badge badge-pill badge-secondary" href="/ja/tags/google/">google</a>
    
    <a class="badge badge-pill badge-secondary" href="/ja/tags/kubernetes/">kubernetes</a>
    
  </div>
  
</div>

  </div>
</div>
      <div class="row">
        <footer class="col-lg-12">
          <hr/>
          <span>&copy; mazgi.log</span>
          <span>&nbsp;&middot;&nbsp;</span>
          <i class="fas fa-bolt"></i>
          <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a></span>
          
          <span>&nbsp;&middot;&nbsp;</span>
          <span>This website <a href="https://policies.google.com/technologies/partner-sites" target="_blank" rel="noopener">uses Google Analytics</a>.</span>
          
        </footer>
      </div>
    </div>
    </main>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68170979-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68170979-2');
    </script>
    
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
  </body>
</html>

